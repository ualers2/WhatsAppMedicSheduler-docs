<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runbook - WhatsApp Medic Scheduler</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Runbook specific styles */
        .runbook-layout {
            display: flex;
            padding-top: 80px;
        }
        .sidebar {
            width: 280px;
            height: calc(100vh - 80px);
            position: fixed;
            left: 0;
            top: 80px;
            background: var(--bg-card);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 1.5rem 0;
            z-index: 100;
        }
        .sidebar-header {
            padding: 0 1.5rem 1rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }
        .sidebar-header h3 {
            color: var(--primary);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .sidebar-menu {
            list-style: none;
        }
        .sidebar-menu li a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .sidebar-menu li a:hover {
            background: var(--bg-hover);
            color: var(--primary);
            border-left-color: var(--primary);
        }
        .sidebar-menu li a.active {
            background: rgba(37, 211, 102, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
            font-weight: 500;
        }
        .sidebar-menu li a i {
            width: 20px;
            text-align: center;
            font-size: 0.85rem;
        }
        .runbook-content {
            flex: 1;
            margin-left: 280px;
            max-width: calc(100% - 280px);
            padding: 2rem 3rem;
        }
        .runbook-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        .runbook-header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }
        .runbook-header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }
        /* Mobile menu toggle */
        .menu-toggle {
            display: none;
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 56px;
            height: 56px;
            background: var(--primary);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
            color: #000;
            font-size: 1.5rem;
        }
        .section {
            margin-bottom: 3rem;
        }
        .section h2 {
            font-size: 1.8rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .section h3 {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin: 1.5rem 0 1rem;
        }
        .section h4 {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin: 1rem 0 0.5rem;
        }
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }
        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        .card-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #000;
        }
        .code-block {
            background: #0d1117;
            border-radius: var(--radius-md);
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
            border: 1px solid var(--border-color);
            position: relative;
        }
        .code-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(125, 211, 252, 0.2);
        }
        .code-block-language {
            font-size: 0.75rem;
            color: var(--primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .code-copy-btn {
            background: var(--primary);
            color: #000;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.2s;
            font-weight: 500;
        }
        .code-copy-btn:hover {
            background: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(37, 211, 102, 0.3);
        }
        .code-copy-btn.copied {
            background: #10b981;
        }
        .code-copy-btn i {
            font-size: 0.9rem;
        }
        .code-block code {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
            color: #7dd3fc;
            display: block;
            white-space: pre;
            word-break: break-word;
        }
        .code-block pre {
            margin: 0;
            padding: 0;
        }
        .inline-code {
            background: var(--bg-hover);
            padding: 0.2rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-family: monospace;
            color: var(--primary);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        th {
            background: var(--bg-hover);
            font-weight: 600;
            color: var(--primary);
        }
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        .step {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .step-number {
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            color: #000;
        }
        .alert {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin: 1rem 0;
            border-left: 4px solid;
        }
        .alert-info {
            background: rgba(52, 183, 241, 0.1);
            border-color: var(--accent);
        }
        .alert-warning {
            background: rgba(252, 161, 48, 0.1);
            border-color: var(--method-put);
        }
        .alert-danger {
            background: rgba(249, 62, 62, 0.1);
            border-color: var(--method-delete);
        }
        .alert-success {
            background: rgba(37, 211, 102, 0.1);
            border-color: var(--primary);
        }
        .service-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: 1rem;
            border-left: 4px solid var(--primary);
        }
        .service-name {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        .service-port {
            font-family: monospace;
            color: var(--method-put);
        }
        .architecture-diagram {
            background: #0d1117;
            border-radius: var(--radius-md);
            padding: 1.5rem;
            font-family: monospace;
            white-space: pre;
            overflow-x: auto;
            font-size: 0.75rem;
            line-height: 1.4;
            color: #7dd3fc;
            border: 1px solid var(--border-color);
        }
        .env-var {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .env-key {
            font-family: monospace;
            color: var(--primary);
        }
        .env-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        .checklist {
            list-style: none;
        }
        .checklist li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }
        .checklist li::before {
            content: 'â˜';
            position: absolute;
            left: 0;
            color: var(--primary);
        }
        .runbook-footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
            margin-top: 3rem;
        }
        @media (max-width: 968px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .runbook-content {
                margin-left: 0;
                max-width: 100%;
                padding: 2rem 1.5rem;
            }
            .menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .architecture-diagram { font-size: 0.6rem; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <!-- Navigation (includes/nav-links.html) -->
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fab fa-whatsapp"></i>
            <span>WhatsApp Medic Scheduler</span>
        </div>
        <div class="nav-links" id="navLinks">
            <!-- Links loaded from includes/nav-links.html -->
        </div>
    </nav>

    <div class="runbook-layout">
        <!-- Sidebar Menu -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-book"></i> Menu do Runbook</h3>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#prerequisitos"><i class="fas fa-clipboard-check"></i> PrÃ©-requisitos</a></li>
                <li><a href="#arquitetura"><i class="fas fa-sitemap"></i> Arquitetura</a></li>
                <li><a href="#instalacao"><i class="fas fa-download"></i> InstalaÃ§Ã£o</a></li>
                <li><a href="#configuracao"><i class="fas fa-cog"></i> ConfiguraÃ§Ã£o</a></li>
                <li><a href="#docker"><i class="fab fa-docker"></i> Deploy Docker</a></li>
                <li><a href="#servicos"><i class="fas fa-server"></i> ServiÃ§os e Portas</a></li>
                <li><a href="#databases"><i class="fas fa-database"></i> Bancos de Dados</a></li>
                <li><a href="#variaveis"><i class="fas fa-key"></i> VariÃ¡veis Ambiente</a></li>
                <li><a href="#backend-estrutura"><i class="fas fa-code"></i> Backend - Estrutura</a></li>
                <li><a href="#agent-ia"><i class="fas fa-robot"></i> Agent IA & Tools</a></li>
                <li><a href="#rag"><i class="fas fa-search"></i> RAG & ChromaDB</a></li>
                <li><a href="#healthcheck"><i class="fas fa-heartbeat"></i> Health Checks</a></li>
                <li><a href="#operacoes"><i class="fas fa-tools"></i> OperaÃ§Ãµes Comuns</a></li>
                <li><a href="#monitoramento"><i class="fas fa-chart-line"></i> Monitoramento</a></li>
                <li><a href="#troubleshooting"><i class="fas fa-bug"></i> Troubleshooting</a></li>
            </ul>
        </aside>

        <!-- Mobile Menu Toggle -->
        <button class="menu-toggle" id="menuToggle" aria-label="Toggle Menu">
            <i class="fas fa-bars"></i>
        </button>

        <main class="runbook-content">
            <div class="runbook-header">
                <h1><i class="fas fa-book"></i> Runbook</h1>
                <p>Guia Completo de InstalaÃ§Ã£o, ConfiguraÃ§Ã£o e OperaÃ§Ã£o do WhatsApp Medic Scheduler</p>
            </div>

        <!-- 1. PrÃ©-requisitos -->
        <section id="prerequisitos" class="section">
            <h2>1. PrÃ©-requisitos</h2>
            
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon"><i class="fas fa-laptop-code"></i></div>
                        <h3>Software NecessÃ¡rio</h3>
                    </div>
                    <ul class="checklist">
                        <li><strong>Python 3.11+</strong> - Runtime principal</li>
                        <li><strong>Docker 24+</strong> - ContainerizaÃ§Ã£o</li>
                        <li><strong>Docker Compose 2.x</strong> - OrquestraÃ§Ã£o</li>
                        <li><strong>Git</strong> - Controle de versÃ£o</li>
                        <li><strong>curl</strong> - Testes de API</li>
                        <li><strong>PostgreSQL client</strong> - psql (opcional)</li>
                        <li><strong>MongoDB client</strong> - mongosh (opcional)</li>
                        <li><strong>Redis CLI</strong> - redis-cli (opcional)</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon"><i class="fas fa-key"></i></div>
                        <h3>Credenciais NecessÃ¡rias</h3>
                    </div>
                    <ul class="checklist">
                        <li><strong>OpenAI API Key</strong> - Agent IA (gpt-4o)</li>
                        <li><strong>Vonage/Twilio</strong> - WhatsApp API</li>
                        <li><strong>AgentOps Key</strong> - Monitoramento agent</li>
                        <li><strong>SMTP Server</strong> - NotificaÃ§Ãµes email</li>
                        <li><strong>Chroma API Key</strong> - Vector DB (opcional)</li>
                        <li><strong>GitHub Token</strong> - Private repos (opcional)</li>
                    </ul>
                </div>
            </div>

            <h3>Requisitos de Recursos</h3>
            <div class="grid-2">
                <div class="card">
                    <h4><i class="fas fa-memory"></i> Computador MÃ­nimo</h4>
                    <ul>
                        <li><strong>CPU:</strong> 4 cores (8 recomendado)</li>
                        <li><strong>RAM:</strong> 8GB (12GB+ recomendado)</li>
                        <li><strong>Disco:</strong> 20GB (SSD)</li>
                        <li><strong>Rede:</strong> ConexÃ£o estÃ¡vel</li>
                    </ul>
                </div>
                <div class="card">
                    <h4><i class="fas fa-docker"></i> Docker Compose Resources</h4>
                    <ul>
                        <li><strong>API Principal:</strong> 800MB RAM, 1.25 CPU</li>
                        <li><strong>Webhooks:</strong> 800MB RAM, 0.80 CPU</li>
                        <li><strong>Mock Gateway:</strong> 800MB RAM, 1.25 CPU</li>
                        <li><strong>DBs + Cache:</strong> ~2GB RAM</li>
                    </ul>
                </div>
            </div>

            <h3>Verificar InstalaÃ§Ãµes</h3>
            <div class="code-block"><code># Python (3.11+)
python --version

# Docker (24.x)
docker --version

# Docker Compose (2.x)
docker compose version

# Git
git --version

# Curl
curl --version</code></div>

            <div class="alert alert-info">
                <strong>ğŸ’¡ Dica Windows:</strong> Usar WSL2 com Docker Desktop para melhor performance. Configure WSL2 como backend padrÃ£o do Docker.
            </div>

            <div class="alert alert-warning">
                <strong>âš ï¸ Nota:</strong> Certifique-se que suas credenciais de API estÃ£o seguras. Nunca faÃ§a commit de .env files no repositÃ³rio.
            </div>
        </section>

        <!-- 2. Arquitetura -->
        <section id="arquitetura" class="section">
            <h2>2. Arquitetura do Sistema</h2>

            <div class="architecture-diagram">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                WhatsApp Medic Scheduler - Arquitetura Final                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚       WhatsApp Provedores             â”‚  â”‚           Backend Services (Flask/FastAPI)  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ Vonage (WhatsApp Business API)    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â€¢ Twilio WhatsApp Cloud             â”‚  â”‚  â”‚  webhooks.py (Port: 3004)              â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â€¢ /twilio/message (Webhook)           â”‚â”‚   â”‚
â”‚  â”‚                â”‚ Webhooks            â”‚  â”‚  â”‚  â€¢ /vonage (Webhook)                   â”‚â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚  â€¢ /vonage/message-status (Eventos)    â”‚â”‚   â”‚
â”‚  â”‚  â”‚ Inbound Messages               â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚  â”‚ (JSON â†’ Processing)            â”‚  â”‚  â”‚            â”‚                              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  api.py (Port: 3000)                 â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”‚ Main Blueprints:                â”‚  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”‚ â€¢ /agent/process â†’ AI Agent     â”‚  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”‚ â€¢ /messages â†’ Message mgmt      â”‚  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”‚ â€¢ /fallback â†’ System Breakdown  â”‚  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”‚ â€¢ /rag â†’ Vector search & docs   â”‚  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚                 â”‚                    â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”‚  Agent IA (OpenAI Agents)     â”‚  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”‚  â”œâ”€ Model: gpt-4o             â”‚  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”‚  â”œâ”€ Input Guardrails          â”‚  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”‚  â”œâ”€ Output Guardrails         â”‚  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”‚  â””â”€ 12+ Tools (Search Slots,  â”‚  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â”‚     OpenBooking, etc...)      â”‚  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚   â”‚
â”‚                   â”‚                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚                   â”‚                        â”‚                                         â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ Data & Storage â”‚                     â”‚  â”‚  â”‚  Mock API Gateway (Port: 5001)   â”‚  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚  â”œâ”€ Simula: AnimatiPACS         â”‚  â”‚   â”‚
â”‚  â”‚                â”‚                     â”‚  â”‚  â”‚  â”œâ”€ 15+ Endpoints                â”‚  â”‚   â”‚
â”‚  â”‚  PostgreSQL    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚  â”‚  â””â”€ Seed: Convenios, Medicos    â”‚  â”‚   â”‚
â”‚  â”‚  (Port: 5122)  â”‚  â”‚ Stored: Patientsâ”‚â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  15+           â”‚  â”‚ - Appointments  â”‚â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚  tables        â”‚  â”‚ - Agendamentos  â”‚â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚                â”‚  â”‚ - Queue Status  â”‚â”‚  â”‚  â”‚  ChromaDB + Vector Search       â”‚  â”‚   â”‚
â”‚  â”‚  â”œâ”€ Threads    â”‚  â”‚ - Fallback Data â”‚â”‚  â”‚  â”‚  â”œâ”€ Embedding: OpenAI           â”‚  â”‚   â”‚
â”‚  â”‚  â”œâ”€ Sessions   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚  â”‚  â”œâ”€ Collections per dept        â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€ Bookings   â”‚                     â”‚  â”‚  â”‚  â””â”€ Context retrieval (RAG)     â”‚  â”‚   â”‚
â”‚  â”‚                â”‚                     â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  MongoDB       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚  (Port: 29017) â”‚  â”‚ Stored: Audit   â”‚â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”œâ”€ Audit Logs â”‚  â”‚ - Conversation  â”‚â”‚  â”‚  â”‚  Redis Cache (Port: 6319)       â”‚  â”‚   â”‚
â”‚  â”‚  â”œâ”€ Webhooks   â”‚  â”‚   History       â”‚â”‚  â”‚  â”‚  â”œâ”€ Session Cache (5 min TTL)   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€ Events     â”‚  â”‚ - Agent Events  â”‚â”‚  â”‚  â”‚  â”œâ”€ Message Dedup               â”‚  â”‚   â”‚
â”‚  â”‚                â”‚  â”‚ - LGPD Logs     â”‚â”‚  â”‚  â”‚  â””â”€ Job Queue                   â”‚  â”‚   â”‚
â”‚  â”‚                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                â”‚                     â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚  Redis         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  (Port: 6319)  â”‚  â”‚ Monitoring:     â”‚â”‚  â”‚  â”‚  PgAdmin (Port: 5050)            â”‚  â”‚   â”‚
â”‚  â”‚  â”œâ”€ Cache      â”‚  â”‚ - AgentOps      â”‚â”‚  â”‚  â”‚  â””â”€ PostgreSQL Admin UI         â”‚  â”‚   â”‚
â”‚  â”‚  â”œâ”€ Dedup      â”‚  â”‚ - Email Alerts  â”‚â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â””â”€ Queues     â”‚  â”‚ - Slack Logs    â”‚â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>

            <h3>Componentes Principais</h3>
            <div class="grid-3">
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-globe"></i> API Principal</div>
                    <p>FastAPI/Uvicorn</p>
                    <p class="service-port">Port: 3000</p>
                    <p>5 workers, 800MB RAM</p>
                    <p>4 Blueprints principais</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-envelope"></i> Webhooks</div>
                    <p>FastAPI/Uvicorn</p>
                    <p class="service-port">Port: 3004</p>
                    <p>5 workers, 800MB RAM</p>
                    <p>Vonage + Twilio</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-robot"></i> Agent IA</div>
                    <p>OpenAI Agents</p>
                    <p class="service-port">Model: gpt-4o</p>
                    <p>12+ Tools integradas</p>
                    <p>Guardrails de seguranÃ§a</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-hospital"></i> Mock Gateway</div>
                    <p>Flask + Flasgger</p>
                    <p class="service-port">Port: 5001</p>
                    <p>AnimatiPACS Mock</p>
                    <p>11+ Controllers</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-database"></i> PostgreSQL</div>
                    <p>VersÃ£o 15</p>
                    <p class="service-port">Port: 5122</p>
                    <p>15+ tabelas</p>
                    <p>Pacientes, agendamentos</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-leaf"></i> MongoDB</div>
                    <p>VersÃ£o 7</p>
                    <p class="service-port">Port: 29017</p>
                    <p>3+ Collections</p>
                    <p>Auditoria LGPD</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-bolt"></i> Redis</div>
                    <p>VersÃ£o 7 Alpine</p>
                    <p class="service-port">Port: 6319</p>
                    <p>Session Cache</p>
                    <p>Dedup + Queues</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-search"></i> ChromaDB</div>
                    <p>Vector Database</p>
                    <p>Embedding: OpenAI</p>
                    <p>RAG por departamento</p>
                    <p>Context retrieval</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-chart-bar"></i> PgAdmin</div>
                    <p>PostgreSQL Admin</p>
                    <p class="service-port">Port: 5050</p>
                    <p>Interface Web</p>
                    <p>Gerenciamento DB</p>
                </div>
            </div>
        </section>

        <!-- 3. InstalaÃ§Ã£o -->
        <section id="instalacao" class="section">
            <h2>3. InstalaÃ§Ã£o</h2>

            <h3>3.1 InstalaÃ§Ã£o RÃ¡pida (Docker)</h3>
            
            <div class="step">
                <div class="step-number">1</div>
                <div>
                    <h4>Clonar RepositÃ³rio</h4>
                    <div class="code-block"><code>git clone https://github.com/ualers2/WhatsAppMedicSheduler.git
cd WhatsAppMedicSheduler</code></div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div>
                    <h4>Configurar VariÃ¡veis de Ambiente</h4>
                    <div class="code-block"><code># Copiar template de variÃ¡veis
cp project/master.env.example project/master.env

# Editar com suas credenciais
code project/master.env  # ou nano/vim</code></div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div>
                    <h4>Build da Imagem Base</h4>
                    <div class="code-block"><code># Construir imagem base com variÃ¡veis de ambiente
cd project
docker compose up --build -d
cd ..</code></div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <div>
                    <h4>Subir Todos os ServiÃ§os</h4>
                    <div class="code-block"><code># Na raiz do projeto
docker compose up -d

# Verificar status
docker compose ps</code></div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">5</div>
                <div>
                    <h4>Inicializar Banco de Dados</h4>
                    <div class="code-block"><code># Executar migraÃ§Ãµes
docker compose exec api_medicsheduler python migrations/run_all_migrations.py

# Popular dados iniciais (mock)
docker compose exec api_medicsheduler python migrations/init_mock_database.py</code></div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">6</div>
                <div>
                    <h4>Verificar InstalaÃ§Ã£o</h4>
                    <div class="code-block"><code># Health check da API
curl http://localhost:3000/rag/health

# Health check Mock Gateway
curl http://localhost:5001/health

# Listar containers
docker compose ps</code></div>
                </div>
            </div>

            <div class="alert alert-success">
                <strong>âœ… Sucesso!</strong> Se todos os health checks retornarem status OK, o sistema estÃ¡ funcionando.
            </div>

            <h3>3.2 InstalaÃ§Ã£o Local (Desenvolvimento)</h3>
            
            <div class="alert alert-warning">
                <strong>âš ï¸ Requer:</strong> Python 3.11+, PostgreSQL, MongoDB, Redis instalados localmente
            </div>

            <div class="code-block"><code># Criar e ativar ambiente virtual
python -m venv venv

# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# Instalar dependÃªncias
pip install -r backend/requirements.txt
pip install -r net_mock_api_gateway/requirements.txt

# Copiar e configurar variÃ¡veis
cp project/master.env backend/app/keys/master.env

# Subir infra (Docker)
docker compose up -d postgres_medicsheduler mongodb_medicsheduler redis_medicsheduler

# Esperar 10s para DBs iniciarem
sleep 10

# Rodar migrations
cd backend
python scripts/_init_.py

# Iniciar APIs em terminais separados
# Terminal 1: API Principal
python api.py

# Terminal 2: Webhooks
python webhooks.py

# Terminal 3: Mock Gateway
cd ../net_mock_api_gateway
python api_gateway.py</code></div>

            <div class="alert alert-info">
                <strong>ğŸ’¡ Dev Tips:</strong>
                <ul>
                    <li>Use <code>FLASK_ENV=development</code> para reload automÃ¡tico</li>
                    <li>ChromaDB cria pasta <code>.chroma</code> localmente (adicione ao .gitignore)</li>
                    <li>Sessions persistem em <code>backend/convthreads/</code></li>
                </ul>
            </div>
        </section>

        <!-- 4. ConfiguraÃ§Ã£o -->
        <section id="configuracao" class="section">
            <h2>4. ConfiguraÃ§Ã£o</h2>

            <h3>4.1 Arquivo master.env</h3>
            <p>O arquivo <code class="inline-code">project/master.env</code> centraliza todas as configuraÃ§Ãµes:</p>

            <div class="card">
                <h4><i class="fas fa-globe"></i> URLs e Modo de API</h4>
                <div class="code-block"><code># Modo Mock (desenvolvimento)
USE_MOCK_API=true
URL_BASE=https://seu-dominio.rshare.io

# URLs da API de HomologaÃ§Ã£o (AnimatiPACS)
ANIMATI_PACS_MOCK_URL=http://net_mock_api_gateway:5001/api-gateway
ANIMATI_PACS_SANDBOX_URL=https://int.public.animatipacs.com.br/api-gateway
ANIMATI_PACS_PRODUCTION_URL=https://ris.clinicasaojose.med.br/api-gateway</code></div>
            </div>

            <div class="card">
                <h4><i class="fas fa-key"></i> Credenciais de API</h4>
                <div class="code-block"><code># OpenAI (obrigatÃ³rio)
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxx

# AgentOps (monitoramento de agente)
AGENTOPS_API_KEY=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# AnimatiPACS API Keys
ANIMATI_PACS_MOCK_API_KEY=eyJhbGciOiJIUzI1NiIs...
ANIMATI_PACS_SANDBOX_API_KEY=eyJhbGciOiJIUzI1NiJ9...
ANIMATI_PACS_PRODUCTION_API_KEY=eyJhbGciOiJIUzI1NiJ9...</code></div>
            </div>

            <div class="card">
                <h4><i class="fab fa-whatsapp"></i> WhatsApp (Vonage/Twilio)</h4>
                <div class="code-block"><code># Vonage
VONAGE_API_KEY=xxxxxxxx
VONAGE_API_SECRET=xxxxxxxxxxxx
VONAGE_APPLICATION_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
VONAGE_APPLICATION_PRIVATE_KEY=C:\path\to\private.key
VONAGE_SIGNATURE_SECRET=xxxxxxxxxxxxxxxxx
VONAGE_NUMBER=14157386102

# Twilio
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_NUMBER=whatsapp:+14155238886</code></div>
            </div>

            <div class="card">
                <h4><i class="fas fa-database"></i> Bancos de Dados</h4>
                <div class="code-block"><code># PostgreSQL
DATABASE_URL=postgresql://postgres:postgres@postgres_medicsheduler:5432/meubanco

# MongoDB
MONGO_URI=mongodb://root:rootpassword@mongodb_medicsheduler:27017/audit_and_logs?authSource=admin
MONGO_DB_NAME=audit_and_logs

# Redis
REDIS_URL=redis://redis_medicsheduler:6379/0</code></div>
            </div>

            <div class="alert alert-warning">
                <strong>âš ï¸ Importante:</strong> Nunca commite o arquivo <code class="inline-code">master.env</code> com credenciais reais. Use <code class="inline-code">.gitignore</code> para protegÃª-lo.
            </div>
        </section>

        <!-- 5. Docker -->
        <section id="docker" class="section">
            <h2>5. Deploy com Docker</h2>

            <h3>5.1 Estrutura de Imagens</h3>
            <table>
                <thead>
                    <tr>
                        <th>Imagem</th>
                        <th>Base</th>
                        <th>PropÃ³sito</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code class="inline-code">mediacutstudio/whatsapp-medic-scheduler:v1.0</code></td>
                        <td>python:3.11-slim</td>
                        <td>Imagem base com master.env</td>
                    </tr>
                    <tr>
                        <td><code class="inline-code">mediacutstudio/api-medicsheduler:v1.0</code></td>
                        <td>Imagem base</td>
                        <td>API Principal</td>
                    </tr>
                    <tr>
                        <td><code class="inline-code">mediacutstudio/webhooks-medicsheduler:v1.0</code></td>
                        <td>Imagem base</td>
                        <td>Webhooks WhatsApp</td>
                    </tr>
                    <tr>
                        <td><code class="inline-code">mediacutstudio/net-mock-api-gateway:v1.0</code></td>
                        <td>Imagem base</td>
                        <td>Mock API Gateway</td>
                    </tr>
                </tbody>
            </table>

            <h3>5.2 Comandos Docker Essenciais</h3>
            
            <div class="card">
                <h4><i class="fas fa-hammer"></i> Build</h4>
                <table>
                    <tr>
                        <td>Build todas as imagens</td>
                        <td><code class="inline-code">docker compose build</code></td>
                    </tr>
                    <tr>
                        <td>Build com cache limpo</td>
                        <td><code class="inline-code">docker compose build --no-cache</code></td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h4><i class="fas fa-play"></i> Iniciar / Parar</h4>
                <table>
                    <tr>
                        <td>Subir todos os serviÃ§os</td>
                        <td><code class="inline-code">docker compose up -d</code></td>
                    </tr>
                    <tr>
                        <td>Subir serviÃ§o especÃ­fico</td>
                        <td><code class="inline-code">docker compose up -d api_medicsheduler</code></td>
                    </tr>
                    <tr>
                        <td>Parar todos os serviÃ§os</td>
                        <td><code class="inline-code">docker compose down</code></td>
                    </tr>
                    <tr>
                        <td>Parar e remover volumes</td>
                        <td><code class="inline-code">docker compose down -v</code></td>
                    </tr>
                    <tr>
                        <td>Reiniciar serviÃ§o</td>
                        <td><code class="inline-code">docker compose restart api_medicsheduler</code></td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h4><i class="fas fa-file-alt"></i> Logs</h4>
                <table>
                    <tr>
                        <td>Ver logs de todos os serviÃ§os</td>
                        <td><code class="inline-code">docker compose logs -f</code></td>
                    </tr>
                    <tr>
                        <td>Ver logs de serviÃ§o especÃ­fico</td>
                        <td><code class="inline-code">docker compose logs -f api_medicsheduler</code></td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h4><i class="fas fa-terminal"></i> ExecuÃ§Ã£o</h4>
                <table>
                    <tr>
                        <td>Executar comando no container</td>
                        <td><code class="inline-code">docker compose exec api_medicsheduler python --version</code></td>
                    </tr>
                    <tr>
                        <td>Acessar shell do container</td>
                        <td><code class="inline-code">docker compose exec api_medicsheduler bash</code></td>
                    </tr>
                </table>
            </div>

            <h3>5.3 Limites de Recursos</h3>
            <table>
                <thead>
                    <tr>
                        <th>ServiÃ§o</th>
                        <th>MemÃ³ria</th>
                        <th>CPU</th>
                        <th>Workers</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>api_medicsheduler</td>
                        <td>800MB</td>
                        <td>1.25</td>
                        <td>5</td>
                    </tr>
                    <tr>
                        <td>webhooks_medicsheduler</td>
                        <td>800MB</td>
                        <td>0.80</td>
                        <td>5</td>
                    </tr>
                    <tr>
                        <td>net_mock_api_gateway</td>
                        <td>800MB</td>
                        <td>1.25</td>
                        <td>1</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- 6. ServiÃ§os e Portas -->
        <section id="servicos" class="section">
            <h2>6. ServiÃ§os e Portas</h2>

            <table>
                <thead>
                    <tr>
                        <th>ServiÃ§o</th>
                        <th>Porta Host</th>
                        <th>Porta Container</th>
                        <th>URL de Acesso</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>API Principal</td>
                        <td>3000</td>
                        <td>3000</td>
                        <td><code class="inline-code">http://localhost:3000</code></td>
                    </tr>
                    <tr>
                        <td>Webhooks</td>
                        <td>3004</td>
                        <td>3004</td>
                        <td><code class="inline-code">http://localhost:3004</code></td>
                    </tr>
                    <tr>
                        <td>Mock API Gateway</td>
                        <td>5001</td>
                        <td>5001</td>
                        <td><code class="inline-code">http://localhost:5001</code></td>
                    </tr>
                    <tr>
                        <td>PostgreSQL</td>
                        <td>5122</td>
                        <td>5432</td>
                        <td><code class="inline-code">localhost:5122</code></td>
                    </tr>
                    <tr>
                        <td>MongoDB</td>
                        <td>29017</td>
                        <td>27017</td>
                        <td><code class="inline-code">localhost:29017</code></td>
                    </tr>
                    <tr>
                        <td>Redis</td>
                        <td>6319</td>
                        <td>6379</td>
                        <td><code class="inline-code">localhost:6319</code></td>
                    </tr>
                    <tr>
                        <td>PgAdmin</td>
                        <td>5050</td>
                        <td>80</td>
                        <td><code class="inline-code">http://localhost:5050</code></td>
                    </tr>
                </tbody>
            </table>

            <h3>URLs Swagger (DocumentaÃ§Ã£o Interativa)</h3>
            <div class="grid-3">
                <div class="card">
                    <h4>API Principal</h4>
                    <p><a href="http://localhost:3000/apidocs" target="_blank">http://localhost:3000/apidocs</a></p>
                </div>
                <div class="card">
                    <h4>Webhooks</h4>
                    <p><a href="http://localhost:3004/apidocs" target="_blank">http://localhost:3004/apidocs</a></p>
                </div>
                <div class="card">
                    <h4>Mock Gateway</h4>
                    <p><a href="http://localhost:5001/apidocs" target="_blank">http://localhost:5001/apidocs</a></p>
                </div>
            </div>
        </section>

        <!-- 7. Bancos de Dados -->
        <section id="databases" class="section">
            <h2>7. Bancos de Dados</h2>

            <h3>7.1 PostgreSQL</h3>
            <div class="card">
                <h4>ConexÃ£o</h4>
                <table>
                    <tr>
                        <td><strong>Via Docker</strong></td>
                        <td><code class="inline-code">docker compose exec postgres_medicsheduler psql -U postgres -d meubanco</code></td>
                    </tr>
                    <tr>
                        <td><strong>Via cliente local</strong></td>
                        <td><code class="inline-code">psql -h localhost -p 5122 -U postgres -d meubanco</code></td>
                    </tr>
                    <tr>
                        <td><strong>String de conexÃ£o</strong></td>
                        <td><code class="inline-code">postgresql://postgres:postgres@localhost:5122/meubanco</code></td>
                    </tr>
                </table>

                <h4>Credenciais PadrÃ£o</h4>
                <table>
                    <tr><td>Host</td><td>localhost</td></tr>
                    <tr><td>Porta</td><td>5122</td></tr>
                    <tr><td>Database</td><td>meubanco</td></tr>
                    <tr><td>UsuÃ¡rio</td><td>postgres</td></tr>
                    <tr><td>Senha</td><td>postgres</td></tr>
                </table>
            </div>

            <h3>7.2 MongoDB</h3>
            <div class="card">
                <h4>ConexÃ£o</h4>
                <table>
                    <tr>
                        <td><strong>Via Docker</strong></td>
                        <td><code class="inline-code">docker compose exec mongodb_medicsheduler mongosh -u root -p rootpassword</code></td>
                    </tr>
                    <tr>
                        <td><strong>String de conexÃ£o</strong></td>
                        <td><code class="inline-code">mongodb://root:rootpassword@localhost:29017/audit_and_logs?authSource=admin</code></td>
                    </tr>
                </table>

                <h4>Collections Principais</h4>
                <ul>
                    <li><code class="inline-code">audit_logs</code> - Logs de auditoria</li>
                    <li><code class="inline-code">conversation_history</code> - HistÃ³rico de conversas</li>
                    <li><code class="inline-code">agent_sessions</code> - SessÃµes do agente</li>
                </ul>
            </div>

            <h3>7.3 Redis</h3>
            <div class="card">
                <h4>ConexÃ£o</h4>
                <table>
                    <tr>
                        <td><strong>Via Docker</strong></td>
                        <td><code class="inline-code">docker compose exec redis_medicsheduler redis-cli</code></td>
                    </tr>
                    <tr>
                        <td><strong>Via cliente local</strong></td>
                        <td><code class="inline-code">redis-cli -h localhost -p 6319</code></td>
                    </tr>
                    <tr>
                        <td><strong>String de conexÃ£o</strong></td>
                        <td><code class="inline-code">redis://localhost:6319/0</code></td>
                    </tr>
                </table>

                <h4>Uso Principal</h4>
                <ul>
                    <li>Cache de sessÃµes</li>
                    <li>DeduplicaÃ§Ã£o de mensagens (TTL 5 min)</li>
                    <li>Filas de processamento</li>
                </ul>
            </div>

            <h3>7.4 PgAdmin</h3>
            <div class="card">
                <p>Interface web para gerenciar PostgreSQL:</p>
                <p><strong>URL:</strong> <a href="http://localhost:5050" target="_blank">http://localhost:5050</a></p>
                <table>
                    <tr><td>Email</td><td>admin@example.com</td></tr>
                    <tr><td>Senha</td><td>pgadmin_medicsheduler_admin_key</td></tr>
                </table>
            </div>
        </section>

        <!-- 8. VariÃ¡veis de Ambiente -->
        <section id="variaveis" class="section">
            <h2>8. VariÃ¡veis de Ambiente</h2>

            <h3>ReferÃªncia Completa</h3>
            <div class="card">
                <h4><i class="fas fa-lock"></i> AutenticaÃ§Ã£o</h4>
                <div class="env-var">
                    <span class="env-key">OPENAI_API_KEY</span>
                    <span class="env-desc">Chave da API OpenAI (obrigatÃ³rio)</span>
                </div>
                <div class="env-var">
                    <span class="env-key">AGENTOPS_API_KEY</span>
                    <span class="env-desc">Chave AgentOps para monitoramento</span>
                </div>
                <div class="env-var">
                    <span class="env-key">ANIMATI_PACS_MOCK_API_KEY</span>
                    <span class="env-desc">JWT para Mock API Gateway</span>
                </div>
                <div class="env-var">
                    <span class="env-key">ANIMATI_PACS_SANDBOX_API_KEY</span>
                    <span class="env-desc">JWT para ambiente de homologaÃ§Ã£o</span>
                </div>
                <div class="env-var">
                    <span class="env-key">ANIMATI_PACS_PRODUCTION_API_KEY</span>
                    <span class="env-desc">JWT para ambiente de produÃ§Ã£o</span>
                </div>
            </div>

            <div class="card">
                <h4><i class="fab fa-whatsapp"></i> WhatsApp - Vonage</h4>
                <div class="env-var">
                    <span class="env-key">VONAGE_API_KEY</span>
                    <span class="env-desc">API Key Vonage</span>
                </div>
                <div class="env-var">
                    <span class="env-key">VONAGE_API_SECRET</span>
                    <span class="env-desc">API Secret Vonage</span>
                </div>
                <div class="env-var">
                    <span class="env-key">VONAGE_APPLICATION_ID</span>
                    <span class="env-desc">ID da aplicaÃ§Ã£o Vonage</span>
                </div>
                <div class="env-var">
                    <span class="env-key">VONAGE_APPLICATION_PRIVATE_KEY</span>
                    <span class="env-desc">Caminho para chave privada</span>
                </div>
                <div class="env-var">
                    <span class="env-key">VONAGE_SIGNATURE_SECRET</span>
                    <span class="env-desc">Secret para validaÃ§Ã£o de assinatura</span>
                </div>
            </div>

            <div class="card">
                <h4><i class="fas fa-server"></i> Infraestrutura</h4>
                <div class="env-var">
                    <span class="env-key">DATABASE_URL</span>
                    <span class="env-desc">URL conexÃ£o PostgreSQL</span>
                </div>
                <div class="env-var">
                    <span class="env-key">MONGO_URI</span>
                    <span class="env-desc">URL conexÃ£o MongoDB</span>
                </div>
                <div class="env-var">
                    <span class="env-key">MONGO_DB_NAME</span>
                    <span class="env-desc">Nome do database MongoDB</span>
                </div>
                <div class="env-var">
                    <span class="env-key">REDIS_URL</span>
                    <span class="env-desc">URL conexÃ£o Redis</span>
                </div>
            </div>

            <div class="card">
                <h4><i class="fas fa-cog"></i> Sistema</h4>
                <div class="env-var">
                    <span class="env-key">USE_MOCK_API</span>
                    <span class="env-desc">true/false - Usar Mock ou ProduÃ§Ã£o</span>
                </div>
                <div class="env-var">
                    <span class="env-key">URL_BASE</span>
                    <span class="env-desc">URL base pÃºblica (webhook)</span>
                </div>
                <div class="env-var">
                    <span class="env-key">FLASK_ENV</span>
                    <span class="env-desc">development/production</span>
                </div>
                <div class="env-var">
                    <span class="env-key">MAX_TOKENS_LIMIT</span>
                    <span class="env-desc">Limite mÃ¡ximo de tokens (300000)</span>
                </div>
            </div>
        </section>

        <!-- 9. Health Checks -->
        <section id="healthcheck" class="section">
            <h2>9. Health Checks</h2>

            <h3>Endpoints de Health</h3>
            <div class="code-block"><code># API Principal
curl http://localhost:3000/rag/health
# Esperado: {"status": "healthy", ...}

# Webhooks
curl http://localhost:3004/health
# Esperado: {"status": "ok"}

# Mock API Gateway  
curl http://localhost:5001/health
# Esperado: {"status": "healthy", "version": "3.98.2"}

# PostgreSQL (via container)
docker compose exec postgres_medicsheduler pg_isready -U postgres
# Esperado: localhost:5432 - accepting connections

# Redis
docker compose exec redis_medicsheduler redis-cli ping
# Esperado: PONG

# MongoDB
docker compose exec mongodb_medicsheduler mongosh --eval "db.adminCommand('ping')"
# Esperado: { ok: 1 }</code></div>
        </section>

        <!-- 10. Troubleshooting -->
        <section id="troubleshooting" class="section">
            <h2>10. Troubleshooting</h2>

            <div class="card">
                <h3><i class="fas fa-exclamation-circle" style="color: var(--method-delete);"></i> Container nÃ£o inicia</h3>
                <div class="code-block"><code># Ver logs do container
docker compose logs api_medicsheduler

# Ver eventos do container
docker events --filter container=api_medicsheduler

# Verificar recursos
docker stats --no-stream</code></div>
                <p><strong>Causas comuns:</strong></p>
                <ul>
                    <li>Porta jÃ¡ em uso</li>
                    <li>MemÃ³ria insuficiente</li>
                    <li>Imagem base nÃ£o encontrada</li>
                </ul>
            </div>

            <div class="card">
                <h3><i class="fas fa-exclamation-circle" style="color: var(--method-delete);"></i> Agent IA retorna erro</h3>
                <div class="code-block"><code># Verificar chave OpenAI
echo $OPENAI_API_KEY

# Verificar logs do agent
docker compose logs -f api_medicsheduler | grep -i agent

# Testar chamada manual
curl -X POST http://localhost:3000/agent/process \
  -H "Content-Type: application/json" \
  -d '{"user_message": "teste"}'</code></div>
                <p><strong>Causas comuns:</strong></p>
                <ul>
                    <li>API Key invÃ¡lida ou expirada</li>
                    <li>Quota de tokens ultrapassada</li>
                    <li>Guardrails bloqueando requisiÃ§Ã£o</li>
                    <li>ChromaDB nÃ£o conectado</li>
                </ul>
            </div>

            <div class="card">
                <h3><i class="fas fa-exclamation-circle" style="color: var(--method-delete);"></i> Webhooks nÃ£o recebem mensagens</h3>
                <p><strong>Passos de debug:</strong></p>
                <ol>
                    <li>Verificar se webhook estÃ¡ acessÃ­vel externamente: <code class="inline-code">ngrok http 3004</code></li>
                    <li>Validar URL no console Vonage/Twilio</li>
                    <li>Ver logs: <code class="inline-code">docker compose logs -f webhooks_medicsheduler</code></li>
                    <li>Testar com curl: <code class="inline-code">curl -X POST http://localhost:3004/vonage -d '...'</code></li>
                </ol>
            </div>

            <div class="card">
                <h3><i class="fas fa-exclamation-circle" style="color: var(--method-delete);"></i> Database connection error</h3>
                <div class="code-block"><code># Verificar se PostgreSQL estÃ¡ rodando
docker compose ps postgres_medicsheduler

# Testar conexÃ£o
docker compose exec postgres_medicsheduler psql -U postgres -d meubanco -c "SELECT 1"

# Resetar PostgreSQL
docker compose down -v postgres_medicsheduler
docker compose up -d postgres_medicsheduler</code></div>
            </div>
        </section>

        <!-- 11. Backend - Estrutura -->
        <section id="backend-estrutura" class="section">
            <h2>11. Backend - Estrutura</h2>

            <h3>OrganizaÃ§Ã£o de DiretÃ³rios</h3>
            <div class="code-block"><code>backend/
â”œâ”€â”€ api.py                    # FastAPI principal (Port 3000)
â”œâ”€â”€ webhooks.py               # Webhooks handler (Port 3004)
â”œâ”€â”€ requirements.txt          # DependÃªncias Python
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ai.py                 # Agent IA - Main orchestrator
â”‚   â”œâ”€â”€ constants.py          # Constants globais
â”‚   â”œâ”€â”€ guardrail.py          # Input/Output validation
â”‚   â”œâ”€â”€ tools.py              # Tool definitions
â”‚   â”œâ”€â”€ blueprints/           # Flask blueprints
â”‚   â”‚   â”œâ”€â”€ agent/            # POST /agent/process
â”‚   â”‚   â”œâ”€â”€ fallback/         # POST /fallback/* (Human handoff)
â”‚   â”‚   â”œâ”€â”€ rag/              # GET /rag/health, POST /rag/search
â”‚   â”‚   â””â”€â”€ webhooks/         # GET /vonage, POST /twilio/message
â”‚   â”œâ”€â”€ keys/                 # Chaves secretas (encrypted)
â”‚   â”œâ”€â”€ models/               # SQLAlchemy models
â”‚   â”‚   â”œâ”€â”€ db.py             # Database connection
â”‚   â”‚   â”œâ”€â”€ fallback_models.py
â”‚   â”‚   â””â”€â”€ system_breakdown.py
â”‚   â”œâ”€â”€ schemas/              # Request/Response schemas
â”‚   â”œâ”€â”€ services/             # Business logic
â”‚   â”‚   â”œâ”€â”€ audit/            # Audit logging (MongoDB)
â”‚   â”‚   â”œâ”€â”€ connectors/       # Vonage, Twilio clients
â”‚   â”‚   â”œâ”€â”€ email/            # SMTP notifications
â”‚   â”‚   â”œâ”€â”€ middleware/       # Request interceptors
â”‚   â”‚   â”œâ”€â”€ rag/              # ChromaDB + search
â”‚   â”‚   â”œâ”€â”€ system_breakdown/ # Fallback handling
â”‚   â”‚   â”œâ”€â”€ twilio/           # Twilio integration
â”‚   â”‚   â””â”€â”€ vonage/           # Vonage integration
â”‚   â””â”€â”€ util/
â”‚       â”œâ”€â”€ config.py         # Load from master.env
â”‚       â”œâ”€â”€ logger.py         # Structured logging
â”‚       â””â”€â”€ util.py           # Helper functions
â”œâ”€â”€ migrations/               # Database migrations
â”‚   â”œâ”€â”€ 001_create_threads_table.sql
â”‚   â”œâ”€â”€ 002_create_items_table.sql
â”‚   â””â”€â”€ ... (10+ migrations)
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ agent/                # Agent-specific scripts
â”‚   â”œâ”€â”€ audit/                # Audit logging
â”‚   â”œâ”€â”€ tools/                # Tool implementations
â”‚   â”‚   â”œâ”€â”€ SearchSlots.py
â”‚   â”‚   â”œâ”€â”€ OpenBooking.py
â”‚   â”‚   â”œâ”€â”€ RetrieveDocumentationContext.py
â”‚   â”‚   â””â”€â”€ ... (12+ tools)
â”‚   â””â”€â”€ healtcheck/
â”œâ”€â”€ mongo-init.js             # MongoDB initialization
â”œâ”€â”€ logs/                     # Log files (volumes)
â””â”€â”€ convthreads/              # Conversation threads cache</code></div>

            <h3>Componentes Principais</h3>

            <div class="card">
                <h4><i class="fas fa-cog"></i> ai.py - Agent IA Orchestrator</h4>
                <p>Arquivo central que orquestra todo o agente de IA.</p>
                <div class="code-block"><code># Responsabilidades:
- Inicializa cliente OpenAI com gpt-4o
- Carrega lista de tools disponÃ­veis
- Aplica input guardrails (validaÃ§Ã£o)
- Executa tool calls em sequÃªncia
- Aplica output guardrails (sanitizaÃ§Ã£o)
- Registra sessÃ£o no MongoDB
- Gerencia contexto RAG</code></div>
            </div>

            <div class="card">
                <h4><i class="fas fa-guarani"></i> guardrail.py - SeguranÃ§a</h4>
                <p>ValidaÃ§Ã£o de input e sanitizaÃ§Ã£o de output.</p>
                <ul>
                    <li><strong>Input Guardrails:</strong> Detecta prompts maliciosos, linguagem abusiva</li>
                    <li><strong>Output Guardrails:</strong> Remove informaÃ§Ãµes sensÃ­veis, valida respostas</li>
                    <li><strong>LGPD Compliance:</strong> Mascaramento de dados pessoais</li>
                </ul>
            </div>

            <div class="card">
                <h4><i class="fas fa-tools"></i> tools.py - Tool Definitions</h4>
                <p>DicionÃ¡rio com todas as ferramentas disponÃ­veis para o agente.</p>
                <div class="code-block"><code"># Exemplo de tool:
{
  "type": "function",
  "function": {
    "name": "SearchSlots",
    "description": "Busca horÃ¡rios disponÃ­veis",
    "parameters": {
      "type": "object",
      "properties": {
        "medico_id": {"type": "string"},
        "data": {"type": "string", "format": "date"}
      }
    }
  }
}</code></div>
            </div>

            <h3>Blueprints (Rotas)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Blueprint</th>
                        <th>Endpoints</th>
                        <th>DescriÃ§Ã£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Agent</strong></td>
                        <td>POST /agent/process</td>
                        <td>Processa mensagem do usuÃ¡rio com Agent IA</td>
                    </tr>
                    <tr>
                        <td><strong>Fallback</strong></td>
                        <td>POST /fallback/create<br>POST /fallback/ticket</td>
                        <td>Cria ticket de atendimento humano</td>
                    </tr>
                    <tr>
                        <td><strong>RAG</strong></td>
                        <td>GET /rag/health<br>POST /rag/search</td>
                        <td>Busca no ChromaDB, health check</td>
                    </tr>
                    <tr>
                        <td><strong>Webhooks</strong></td>
                        <td>POST /twilio/message<br>POST /vonage<br>POST /vonage/message-status</td>
                        <td>Recebe mensagens dos provedores</td>
                    </tr>
                </tbody>
            </table>

            <h3>Models (Database)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Tabela</th>
                        <th>DescriÃ§Ã£o</th>
                        <th>DB</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>threads</td>
                        <td>Conversas entre usuÃ¡rios e agente</td>
                        <td>PostgreSQL</td>
                    </tr>
                    <tr>
                        <td>items</td>
                        <td>Mensagens individuais (histÃ³rico)</td>
                        <td>PostgreSQL</td>
                    </tr>
                    <tr>
                        <td>system_state</td>
                        <td>Estado atual do agente</td>
                        <td>PostgreSQL</td>
                    </tr>
                    <tr>
                        <td>fallback_tickets</td>
                        <td>Tickets de atendimento humano</td>
                        <td>PostgreSQL</td>
                    </tr>
                    <tr>
                        <td>chat_requests</td>
                        <td>RequisiÃ§Ãµes recebidas</td>
                        <td>PostgreSQL</td>
                    </tr>
                    <tr>
                        <td>audit_logs</td>
                        <td>Log de todas as aÃ§Ãµes (LGPD)</td>
                        <td>MongoDB</td>
                    </tr>
                </tbody>
            </table>

            <h3>Services (LÃ³gica de NegÃ³cio)</h3>
            <div class="grid-2">
                <div class="card">
                    <h4>Audit Service</h4>
                    <p>Registra em MongoDB todas as aÃ§Ãµes para LGPD.</p>
                </div>
                <div class="card">
                    <h4>Connector Services</h4>
                    <p>Vonage e Twilio clients para enviar mensagens.</p>
                </div>
                <div class="card">
                    <h4>Email Service</h4>
                    <p>SMTP para notificaÃ§Ãµes e alertas.</p>
                </div>
                <div class="card">
                    <h4>RAG Service</h4>
                    <p>IntegraÃ§Ã£o com ChromaDB para busca contextual.</p>
                </div>
                <div class="card">
                    <h4>System Breakdown</h4>
                    <p>Fallback quando agente falha.</p>
                </div>
                <div class="card">
                    <h4>Middleware</h4>
                    <p>Interceptadores de requisiÃ§Ã£o/resposta.</p>
                </div>
            </div>

            <h3>Scripts de UtilitÃ¡rio</h3>
            <div class="code-block"><code># Testar todas as tools
cd backend/scripts
python tools/TEST_ALL_TOOLS.py

# Criar log de auditoria
python audit/create_log.py

# Buscar paciente no connector
python schemas/fetch_patient_by_connector.py

# Health check
python healtcheck/test_api.py</code></div>
        </section>

        <!-- 12. Agent IA & Tools -->
        <section id="agent-ia" class="section">
            <h2>12. Agent IA & Tools</h2>

            <h3>VisÃ£o Geral do Agent</h3>
            <div class="card">
                <p><strong>Modelo:</strong> GPT-4o (OpenAI)</p>
                <p><strong>Framework:</strong> OpenAI Agents (Assistants API v2)</p>
                <p><strong>Monitoramento:</strong> AgentOps</p>
                <p><strong>Contexto:</strong> RAG via ChromaDB</p>
                <p><strong>SeguranÃ§a:</strong> Input/Output Guardrails</p>
            </div>

            <h3>12 Tools DisponÃ­veis</h3>
            <table>
                <thead>
                    <tr>
                        <th>Tool</th>
                        <th>Arquivo</th>
                        <th>DescriÃ§Ã£o</th>
                        <th>Tipo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>SearchSlots</strong></td>
                        <td>SearchSlots.py</td>
                        <td>Busca horÃ¡rios disponÃ­veis para consulta</td>
                        <td>Query</td>
                    </tr>
                    <tr>
                        <td><strong>OpenBooking</strong></td>
                        <td>OpenBooking.py</td>
                        <td>Abre agendamento para paciente</td>
                        <td>Action</td>
                    </tr>
                    <tr>
                        <td><strong>SearchUnidade</strong></td>
                        <td>SearchUnidade.py</td>
                        <td>Busca unidade de atendimento</td>
                        <td>Query</td>
                    </tr>
                    <tr>
                        <td><strong>SearchSala</strong></td>
                        <td>SearchSala.py</td>
                        <td>Busca sala de atendimento</td>
                        <td>Query</td>
                    </tr>
                    <tr>
                        <td><strong>ListConvenios</strong></td>
                        <td>ListConvenios.py</td>
                        <td>Lista convÃªnios disponÃ­veis</td>
                        <td>Query</td>
                    </tr>
                    <tr>
                        <td><strong>ListPlanosConvenio</strong></td>
                        <td>ListPlanosConvenio.py</td>
                        <td>Lista planos de um convÃªnio</td>
                        <td>Query</td>
                    </tr>
                    <tr>
                        <td><strong>ListProcedimentos</strong></td>
                        <td>ListProcedimentos.py</td>
                        <td>Lista procedimentos disponÃ­veis</td>
                        <td>Query</td>
                    </tr>
                    <tr>
                        <td><strong>ListFiliais</strong></td>
                        <td>ListFiliais.py</td>
                        <td>Lista filiais da clÃ­nica</td>
                        <td>Query</td>
                    </tr>
                    <tr>
                        <td><strong>RetrieveDocumentationContext</strong></td>
                        <td>RetrieveDocumentationContext.py</td>
                        <td>Busca no ChromaDB (RAG)</td>
                        <td>Query</td>
                    </tr>
                    <tr>
                        <td><strong>GetCurrentDate</strong></td>
                        <td>GetCurrentDate.py</td>
                        <td>Retorna data/hora atual</td>
                        <td>Utility</td>
                    </tr>
                    <tr>
                        <td><strong>FallbackToHuman</strong></td>
                        <td>FallbackToHuman.py</td>
                        <td>Encaminha para atendimento humano</td>
                        <td>Action</td>
                    </tr>
                </tbody>
            </table>

            <h3>Fluxo de ExecuÃ§Ã£o</h3>
            <div class="card">
                <div class="code-block"><code">1. Mensagem recebida via webhook (Vonage/Twilio)
   â†“
2. ValidaÃ§Ã£o de input (Guardrails)
   â†“
3. Busca de contexto no RAG (ChromaDB)
   â†“
4. Agent IA processa com GPT-4o
   â†“
5. Se precisa tool â†’ Executa tool correspondente
   â†“
6. Aguarda resposta e processa nova iteraÃ§Ã£o
   â†“
7. ValidaÃ§Ã£o de output (Guardrails)
   â†“
8. Envia resposta via WhatsApp
   â†“
9. Auditoria registrada em MongoDB</code></div>
            </div>

            <h3>Exemplo: Processar Mensagem</h3>
            <div class="code-block"><code"># Request
curl -X POST http://localhost:3000/agent/process \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "5511999999999",
    "user_name": "JoÃ£o Silva",
    "message": "Quero agendar uma consulta com um cardiologista",
    "thread_id": "abc123" # opcional, cria nova se nÃ£o informar
  }'

# Response
{
  "agent_response": "Encontrei 3 cardiologistas disponÃ­veis. VocÃª prefere qual?",
  "thread_id": "abc123",
  "session_id": "sess_xyz",
  "tool_calls": [
    {
      "tool": "SearchSlots",
      "status": "success"
    }
  ]
}</code></div>

            <h3>Monitoramento do Agent</h3>
            <div class="card">
                <p><strong>AgentOps Dashboard:</strong> <a href="https://app.agentops.ai" target="_blank">https://app.agentops.ai</a></p>
                <ul>
                    <li>SessÃµes do agente com metadata</li>
                    <li>Uso de tokens (input/output/cache)</li>
                    <li>Chamadas de tools executadas</li>
                    <li>Tempo de resposta de cada step</li>
                    <li>Erros e exceÃ§Ãµes</li>
                    <li>AnÃ¡lise de custo</li>
                </ul>
            </div>

            <h3>ConfiguraÃ§Ã£o do Agent (master.env)</h3>
            <div class="code-block"><code"># OpenAI
OPENAI_API_KEY=sk-proj-xxx
OPENAI_MODEL=gpt-4o
OPENAI_MAX_TOKENS=8000

# AgentOps (opcional)
AGENTOPS_KEY=xxx
AGENTOPS_ENABLED=true

# Guardrails
ENABLE_INPUT_GUARDRAILS=true
ENABLE_OUTPUT_GUARDRAILS=true
MAX_CONVERSATION_LENGTH=20

# RAG/ChromaDB
CHROMA_ENABLED=true
CHROMA_SIMILARITY_THRESHOLD=0.7
RAG_SEARCH_LIMIT=5</code></div>
        </section>

        <!-- 13. RAG & ChromaDB -->
        <section id="rag" class="section">
            <h2>13. RAG (Retrieval-Augmented Generation) & ChromaDB</h2>

            <h3>O que Ã© RAG?</h3>
            <div class="card">
                <p>RAG (Retrieval-Augmented Generation) augmenta o LLM com busca em documentaÃ§Ã£o relevante, permitindo respostas mais precisas e fundamentadas em dados especÃ­ficos do domÃ­nio.</p>
                <p><strong>Fluxo:</strong></p>
                <ol>
                    <li>Pergunta do usuÃ¡rio Ã© convertida em embedding (OpenAI)</li>
                    <li>Busca de documentos similares no ChromaDB</li>
                    <li>Documentos sÃ£o adicionados ao contexto do agent</li>
                    <li>Agent gera resposta com informaÃ§Ã£o recuperada</li>
                </ol>
            </div>

            <h3>ChromaDB - Vector Database</h3>
            <div class="grid-2">
                <div class="card">
                    <h4><i class="fas fa-database"></i> Collections</h4>
                    <p>ChromaDB armazena embeddings organizados por departamento/coleÃ§Ã£o:</p>
                    <ul>
                        <li><strong>cardiologia</strong> - Documentos de cardiologia</li>
                        <li><strong>pediatria</strong> - Documentos de pediatria</li>
                        <li><strong>general</strong> - PolÃ­ticas e procedimentos gerais</li>
                        <li><strong>faq</strong> - Perguntas frequentes</li>
                    </ul>
                </div>
                <div class="card">
                    <h4><i class="fas fa-puzzle-piece"></i> Embeddings</h4>
                    <p>Texto Ã© convertido em vetor 1536-dimensional usando:</p>
                    <ul>
                        <li><strong>Modelo:</strong> text-embedding-3-small (OpenAI)</li>
                        <li><strong>DimensÃ£o:</strong> 1536</li>
                        <li><strong>Token Limit:</strong> 8191</li>
                    </ul>
                </div>
            </div>

            <h3>Adicionar DocumentaÃ§Ã£o ao RAG</h3>
            <div class="card">
                <h4>MÃ©todo 1: Via API</h4>
                <div class="code-block"><code"># POST /rag/add-documents
curl -X POST http://localhost:3000/rag/add-documents \
  -H "Content-Type: application/json" \
  -d '{
    "collection": "cardiologia",
    "documents": [
      {
        "id": "doc_001",
        "content": "A hipertensÃ£o Ã©...",
        "metadata": {"source": "manual"}
      }
    ]
  }'</code></div>
            </div>

            <div class="card">
                <h4>MÃ©todo 2: Via Script Python</h4>
                <div class="code-block"><code"># scripts/seeds/seed_rag.py
import chromadb

client = chromadb.HttpClient(host="localhost", port=8000)
collection = client.get_or_create_collection("cardiologia")

collection.add(
    ids=["doc_001"],
    documents=["ConteÃºdo do documento"],
    metadatas=[{"source": "manual"}]
)</code></div>
            </div>

            <h3>Buscar no RAG</h3>
            <div class="code-block"><code"># POST /rag/search
curl -X POST http://localhost:3000/rag/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Como tratar hipertensÃ£o?",
    "collection": "cardiologia",
    "limit": 5,
    "threshold": 0.7
  }'

# Response
{
  "results": [
    {
      "id": "doc_001",
      "distance": 0.15,  # menor = mais similar
      "content": "A hipertensÃ£o...",
      "metadata": {"source": "manual"}
    }
  ]
}</code></div>

            <h3>ConfiguraÃ§Ã£o RAG (master.env)</h3>
            <div class="code-block"><code"># ChromaDB
CHROMA_HOST=localhost
CHROMA_PORT=8000
CHROMA_ENABLED=true

# Embeddings
EMBEDDING_MODEL=text-embedding-3-small
EMBEDDING_DIMENSION=1536

# Search
RAG_SEARCH_LIMIT=5
RAG_SIMILARITY_THRESHOLD=0.7
RAG_AUTO_REFRESH=true</code></div>

            <h3>Health Check RAG</h3>
            <div class="code-block"><code"># Check endpoint
curl http://localhost:3000/rag/health

# Response
{
  "status": "healthy",
  "collections": 4,
  "documents": 234,
  "last_update": "2025-12-14T10:30:00Z"
}</code></div>
        </section>

        <!-- 14. OperaÃ§Ãµes Comuns -->
        <section id="operacoes" class="section">
            <h2>14. OperaÃ§Ãµes Comuns</h2>

            <h3>Blueprints e Fluxo de RequisiÃ§Ã£o</h3>
            <div class="card">
                <p><strong>Estrutura de Rotas (blueprints/):</strong></p>
                <table>
                    <tr>
                        <td><strong>agent/</strong></td>
                        <td>Processamento de mensagens com IA<br/><code>/agent/process</code> - Main entrypoint</td>
                    </tr>
                    <tr>
                        <td><strong>fallback/</strong></td>
                        <td>Sistema de fallback para falhas<br/><code>/fallback/create-ticket</code></td>
                    </tr>
                    <tr>
                        <td><strong>rag/</strong></td>
                        <td>Retrieval Augmented Generation<br/><code>/rag/search</code></td>
                    </tr>
                    <tr>
                        <td><strong>webhooks/</strong></td>
                        <td>RecepÃ§Ã£o webhooks externos<br/><code>/twilio/message</code>, <code>/vonage</code></td>
                    </tr>
                </table>
            </div>

            <h3>Agent IA - OpenAI Agents</h3>
            <div class="card">
                <h4>ConfiguraÃ§Ã£o</h4>
                <div class="code-block"><code># backend/app/ai.py
MODEL = "gpt-4o"
WORKFLOW_NAME = "MedicScheduler Agent"
PARALLEL_TOOL_CALLS = False
MAX_ITERATIONS = 10

# Guardrails de seguranÃ§a
input_guardrails = [input_safety_guardrail]
output_guardrails = [output_safety_guardrail]</code></div>
            </div>

            <h3>Tools DisponÃ­veis (12+)</h3>
            <div class="card">
                <p><strong>LocalizaÃ§Ã£o:</strong> <code>backend/scripts/tools/</code></p>
                <ul style="columns: 2; column-gap: 2rem;">
                    <li>âœ… SearchSlots - Busca horÃ¡rios</li>
                    <li>âœ… OpenBooking - Confirma agendamento</li>
                    <li>âœ… ListConvenios - Lista convÃªnios</li>
                    <li>âœ… ListProcedimentos - Procedimentos</li>
                    <li>âœ… SearchUnidade - Localiza unidades</li>
                    <li>âœ… SearchSala - Busca salas</li>
                    <li>âœ… ListFiliais - Lista filiais</li>
                    <li>âœ… ListPlanosConvenio - Planos</li>
                    <li>âœ… GetCurrentDate - Data/hora</li>
                    <li>âœ… RetrieveDocContext - RAG search</li>
                    <li>âœ… FallbackToHuman - Escala humana</li>
                    <li>âœ… TEST_ALL_TOOLS - Test suite</li>
                </ul>
            </div>

            <h3>Services Principais</h3>
            <div class="card">
                <p><strong>LocalizaÃ§Ã£o:</strong> <code>backend/app/services/</code></p>
                <ul>
                    <li><strong>audit/</strong> - Logging LGPD MongoDB</li>
                    <li><strong>connectors/</strong> - AnimatiPACS integration</li>
                    <li><strong>email/</strong> - SMTP notifications</li>
                    <li><strong>middleware/</strong> - Request processing</li>
                    <li><strong>rag/</strong> - ChromaDB + embeddings</li>
                    <li><strong>system_breakdown/</strong> - Failover detection</li>
                    <li><strong>twilio/</strong> - Twilio integration</li>
                    <li><strong>vonage/</strong> - Vonage integration</li>
                </ul>
            </div>

            <h3>Mock Gateway - AnimatiPACS (11+ Controllers)</h3>
            <div class="card">
                <p><strong>LocalizaÃ§Ã£o:</strong> <code>net_mock_api_gateway/blueprints/netpacs_mock/</code></p>
                <ul style="columns: 2; column-gap: 2rem;">
                    <li>auth_controller</li>
                    <li>convenio_controller</li>
                    <li>medico_controller</li>
                    <li>horario_controller</li>
                    <li>paciente_controller</li>
                    <li>procedimento_controller</li>
                    <li>unidade_controller</li>
                    <li>filiais_controller</li>
                    <li>sala_controller</li>
                    <li>consulta_preco_controller</li>
                </ul>
            </div>
        </section>

        <!-- 15. Monitoramento -->
curl http://localhost:5001/health

# PostgreSQL
docker compose exec postgres_medicsheduler pg_isready -U postgres

# Redis
docker compose exec redis_medicsheduler redis-cli ping

# MongoDB
docker compose exec mongodb_medicsheduler mongosh --eval "db.adminCommand('ping')"</code></div>

            <h3>Logs em Tempo Real</h3>
            <div class="card">
                <table>
                    <tr>
                        <td>Todos os serviÃ§os</td>
                        <td><code class="inline-code">docker compose logs -f</code></td>
                    </tr>
                    <tr>
                        <td>ServiÃ§o especÃ­fico</td>
                        <td><code class="inline-code">docker compose logs -f api_medicsheduler</code></td>
                    </tr>
                    <tr>
                        <td>Ãšltimas 100 linhas</td>
                        <td><code class="inline-code">docker compose logs --tail 100 api_medicsheduler</code></td>
                    </tr>
                </table>
            </div>

            <h3>Swagger UIs</h3>
            <div class="grid-3">
                <div class="card">
                    <h4>API Principal</h4>
                    <p><a href="http://localhost:3000/apidocs" target="_blank">localhost:3000/apidocs</a></p>
                </div>
                <div class="card">
                    <h4>Webhooks</h4>
                    <p><a href="http://localhost:3004/apidocs" target="_blank">localhost:3004/apidocs</a></p>
                </div>
                <div class="card">
                    <h4>Mock Gateway</h4>
                    <p><a href="http://localhost:5001/apidocs" target="_blank">localhost:5001/apidocs</a></p>
                </div>
            </div>

            <div class="card">
                <h3>Erros Comuns</h3>

            <div class="card">
                <h3><i class="fas fa-exclamation-circle" style="color: var(--method-delete);"></i> Erro de conexÃ£o com banco</h3>
                <div class="code-block"><code># Verificar se PostgreSQL estÃ¡ rodando
docker compose ps postgres_medicsheduler

# Testar conexÃ£o
docker compose exec postgres_medicsheduler pg_isready -U postgres

# Ver logs do PostgreSQL
docker compose logs postgres_medicsheduler</code></div>
                <p><strong>SoluÃ§Ãµes:</strong></p>
                <ul>
                    <li>Verificar DATABASE_URL no master.env</li>
                    <li>Confirmar que container PostgreSQL estÃ¡ healthy</li>
                    <li>Verificar se rede Docker estÃ¡ correta</li>
                </ul>
            </div>

            <div class="card">
                <h3><i class="fas fa-exclamation-circle" style="color: var(--method-delete);"></i> Limpar tudo e recomeÃ§ar</h3>
                <div class="code-block"><code># Parar todos os containers
docker compose down

# Remover volumes (CUIDADO: apaga dados!)
docker compose down -v

# Remover imagens do projeto
docker rmi $(docker images -q mediacutstudio/*)

# Limpar cache Docker
docker system prune -af

# Reconstruir do zero
docker compose build --no-cache
docker compose up -d</code></div>
            </div>

            <h3>Backup e Restore</h3>
            <div class="card">
                <h4>Backup PostgreSQL</h4>
                <div class="code-block"><code># Backup completo
docker compose exec postgres_medicsheduler pg_dump -U postgres meubanco > backup.sql

# Backup compactado
docker compose exec postgres_medicsheduler pg_dump -U postgres meubanco | gzip > backup.sql.gz

# Restore
cat backup.sql | docker compose exec -T postgres_medicsheduler psql -U postgres -d meubanco</code></div>
            </div>

            <div class="card">
                <h4>Backup MongoDB</h4>
                <div class="code-block"><code># Backup
docker compose exec mongodb_medicsheduler mongodump -u root -p rootpassword --authenticationDatabase admin -d audit_and_logs --out /data/backup

# Copiar para host
docker cp mongodb_medicsheduler:/data/backup ./mongo_backup

# Restore
docker compose exec mongodb_medicsheduler mongorestore -u root -p rootpassword --authenticationDatabase admin /data/backup</code></div>
            </div>

            <h3>AtualizaÃ§Ã£o do Sistema</h3>
            <div class="card">
                <div class="code-block"><code># Pull das Ãºltimas mudanÃ§as
git pull origin main

# Rebuild das imagens
docker compose build

# Reiniciar serviÃ§os
docker compose up -d

# Executar migraÃ§Ãµes (se houver)
docker compose exec api_medicsheduler python migrations/run_all_migrations.py</code></div>
            </div>

            <h3>Executar Migrations</h3>
            <div class="card">
                <div class="code-block"><code># Executar todas as migraÃ§Ãµes
docker compose exec api_medicsheduler python migrations/run_all_migrations.py

# MigraÃ§Ãµes especÃ­ficas
docker compose exec api_medicsheduler python migrations/001_create_fallback_tables.py
docker compose exec api_medicsheduler python migrations/002_populate_convenios.py
docker compose exec api_medicsheduler python migrations/003_populate_plano_convenios.py

# Recriar mock database
docker compose exec api_medicsheduler python migrations/rebuild_mock_database.py</code></div>
            </div>
        </section>

        <!-- 15. Monitoramento -->
        <section id="monitoramento" class="section">
            <h2>15. Monitoramento</h2>

            <h3>Logs</h3>
            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>DescriÃ§Ã£o</th>
                            <th>Comando</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Logs em tempo real (todos)</td>
                            <td><code class="inline-code">docker compose logs -f</code></td>
                        </tr>
                        <tr>
                            <td>Logs de serviÃ§o especÃ­fico</td>
                            <td><code class="inline-code">docker compose logs -f api_medicsheduler</code></td>
                        </tr>
                        <tr>
                            <td>Ãšltimas 100 linhas</td>
                            <td><code class="inline-code">docker compose logs --tail 100 api_medicsheduler</code></td>
                        </tr>
                        <tr>
                            <td>Logs com timestamp</td>
                            <td><code class="inline-code">docker compose logs -f -t api_medicsheduler</code></td>
                        </tr>
                        <tr>
                            <td>Logs salvos (volumes)</td>
                            <td><code class="inline-code">ls -la backend/logs/</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>MÃ©tricas de Container</h3>
            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>DescriÃ§Ã£o</th>
                            <th>Comando</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>CPU, memÃ³ria, rede (tempo real)</td>
                            <td><code class="inline-code">docker stats</code></td>
                        </tr>
                        <tr>
                            <td>Apenas serviÃ§os especÃ­ficos</td>
                            <td><code class="inline-code">docker stats api_medicsheduler webhooks_medicsheduler</code></td>
                        </tr>
                        <tr>
                            <td>Snapshot (sem streaming)</td>
                            <td><code class="inline-code">docker stats --no-stream</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>AgentOps (Monitoramento de Agente IA)</h3>
            <div class="card">
                <p>O sistema usa AgentOps para monitorar execuÃ§Ãµes do agente de IA.</p>
                <p><strong>Dashboard:</strong> <a href="https://app.agentops.ai" target="_blank">https://app.agentops.ai</a></p>
                <ul>
                    <li>Rastreamento de sessÃµes do agente</li>
                    <li>MÃ©tricas de uso de tokens</li>
                    <li>AnÃ¡lise de chamadas de tools</li>
                    <li>Debugging de conversas</li>
                </ul>
            </div>

            <h3>Swagger UI (DocumentaÃ§Ã£o de API)</h3>
            <div class="grid-3">
                <div class="card">
                    <h4>API Principal</h4>
                    <p><a href="http://localhost:3000/apidocs" target="_blank">localhost:3000/apidocs</a></p>
                </div>
                <div class="card">
                    <h4>Webhooks</h4>
                    <p><a href="http://localhost:3004/apidocs" target="_blank">localhost:3004/apidocs</a></p>
                </div>
                <div class="card">
                    <h4>Mock Gateway</h4>
                    <p><a href="http://localhost:5001/apidocs" target="_blank">localhost:5001/apidocs</a></p>
                </div>
            </div>

            <h3>Alertas por Email</h3>
            <div class="card">
                <p>O sistema envia alertas por email em caso de falhas crÃ­ticas.</p>
                <p>Configure no <code class="inline-code">master.env</code>:</p>
                <div class="code-block"><code>SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=seu-email@gmail.com
SMTP_PASSWORD=xxxx xxxx xxxx xxxx
ADMIN_EMAIL_LIST=admin@exemplo.com,dev@exemplo.com</code></div>
            </div>
        </section>

        <footer class="runbook-footer">
            <p><i class="fas fa-book"></i> Runbook - WhatsApp Medic Scheduler v3.0 (Final Phase - Fase de ProduÃ§Ã£o)</p>
            <p>Ãšltima atualizaÃ§Ã£o: 14 de Dezembro de 2025 | Estrutura Completa: Agent IA, 12+ Tools, RAG, ChromaDB, Vonage/Twilio, Fallback System</p>
            <p><small>Desenvolvido para AnimatiPACS | Pronto para deploy em produÃ§Ã£o | DocumentaÃ§Ã£o atualizada</small></p>
        </footer>
        </main>
    </div>

    <script>
        // FunÃ§Ã£o para processar blocos de cÃ³digo
        function initializeCodeBlocks() {
            document.querySelectorAll('.code-block').forEach((block, index) => {
                const code = block.querySelector('code');
                if (!code) return;

                const codeText = code.textContent;
                
                // Criar container com header
                const header = document.createElement('div');
                header.className = 'code-block-header';
                
                const language = document.createElement('div');
                language.className = 'code-block-language';
                language.textContent = '$ bash';
                
                const copyBtn = document.createElement('button');
                copyBtn.className = 'code-copy-btn';
                copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copiar';
                copyBtn.setAttribute('data-code-index', index);
                
                copyBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Copiar para clipboard
                    navigator.clipboard.writeText(codeText).then(() => {
                        // Feedback visual
                        const originalText = copyBtn.innerHTML;
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copiado!';
                        copyBtn.classList.add('copied');
                        
                        setTimeout(() => {
                            copyBtn.innerHTML = originalText;
                            copyBtn.classList.remove('copied');
                        }, 2000);
                    }).catch(() => {
                        alert('Erro ao copiar. Tente novamente.');
                    });
                });
                
                header.appendChild(language);
                header.appendChild(copyBtn);
                
                // Inserir header no inÃ­cio do bloco
                code.parentNode.insertBefore(header, code);
            });
        }

        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            const icon = menuToggle.querySelector('i');
            icon.classList.toggle('fa-bars');
            icon.classList.toggle('fa-times');
        });

        // Close sidebar when clicking a link (mobile)
        document.querySelectorAll('.sidebar-menu a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 968) {
                    sidebar.classList.remove('active');
                    const icon = menuToggle.querySelector('i');
                    icon.classList.add('fa-bars');
                    icon.classList.remove('fa-times');
                }
            });
        });

        // Highlight active section on scroll
        const sections = document.querySelectorAll('section[id]');
        const menuLinks = document.querySelectorAll('.sidebar-menu a');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 150;
                if (scrollY >= sectionTop) {
                    current = section.getAttribute('id');
                }
            });

            menuLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });

        // Inicializar blocos de cÃ³digo quando o DOM estÃ¡ pronto
        document.addEventListener('DOMContentLoaded', initializeCodeBlocks);
        
        // Se o documento jÃ¡ foi carregado, inicializar imediatamente
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeCodeBlocks);
        } else {
            initializeCodeBlocks();
        }
    </script>
    <script src="js/main.js"></script>
</body>
</html>
