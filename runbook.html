<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runbook - WhatsApp Medic Scheduler</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Runbook specific styles */
        .runbook-layout {
            display: flex;
            padding-top: 80px;
        }
        .sidebar {
            width: 280px;
            height: calc(100vh - 80px);
            position: fixed;
            left: 0;
            top: 80px;
            background: var(--bg-card);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 1.5rem 0;
            z-index: 100;
        }
        .sidebar-header {
            padding: 0 1.5rem 1rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }
        .sidebar-header h3 {
            color: var(--primary);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .sidebar-menu {
            list-style: none;
        }
        .sidebar-menu li a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .sidebar-menu li a:hover {
            background: var(--bg-hover);
            color: var(--primary);
            border-left-color: var(--primary);
        }
        .sidebar-menu li a.active {
            background: rgba(37, 211, 102, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
            font-weight: 500;
        }
        .sidebar-menu li a i {
            width: 20px;
            text-align: center;
            font-size: 0.85rem;
        }
        .runbook-content {
            flex: 1;
            margin-left: 280px;
            max-width: calc(100% - 280px);
            padding: 2rem 3rem;
        }
        .runbook-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        .runbook-header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }
        .runbook-header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }
        /* Mobile menu toggle */
        .menu-toggle {
            display: none;
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 56px;
            height: 56px;
            background: var(--primary);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
            color: #000;
            font-size: 1.5rem;
        }
        .section {
            margin-bottom: 3rem;
        }
        .section h2 {
            font-size: 1.8rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .section h3 {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin: 1.5rem 0 1rem;
        }
        .section h4 {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin: 1rem 0 0.5rem;
        }
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }
        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        .card-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #000;
        }
        .code-block {
            background: #0d1117;
            border-radius: var(--radius-md);
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
            border: 1px solid var(--border-color);
        }
        .code-block code {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
            color: #7dd3fc;
        }
        .inline-code {
            background: var(--bg-hover);
            padding: 0.2rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-family: monospace;
            color: var(--primary);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        th {
            background: var(--bg-hover);
            font-weight: 600;
            color: var(--primary);
        }
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        .step {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .step-number {
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            color: #000;
        }
        .alert {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin: 1rem 0;
            border-left: 4px solid;
        }
        .alert-info {
            background: rgba(52, 183, 241, 0.1);
            border-color: var(--accent);
        }
        .alert-warning {
            background: rgba(252, 161, 48, 0.1);
            border-color: var(--method-put);
        }
        .alert-danger {
            background: rgba(249, 62, 62, 0.1);
            border-color: var(--method-delete);
        }
        .alert-success {
            background: rgba(37, 211, 102, 0.1);
            border-color: var(--primary);
        }
        .service-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: 1rem;
            border-left: 4px solid var(--primary);
        }
        .service-name {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        .service-port {
            font-family: monospace;
            color: var(--method-put);
        }
        .architecture-diagram {
            background: #0d1117;
            border-radius: var(--radius-md);
            padding: 1.5rem;
            font-family: monospace;
            white-space: pre;
            overflow-x: auto;
            font-size: 0.75rem;
            line-height: 1.4;
            color: #7dd3fc;
            border: 1px solid var(--border-color);
        }
        .env-var {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .env-key {
            font-family: monospace;
            color: var(--primary);
        }
        .env-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        .checklist {
            list-style: none;
        }
        .checklist li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }
        .checklist li::before {
            content: 'â˜';
            position: absolute;
            left: 0;
            color: var(--primary);
        }
        .runbook-footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
            margin-top: 3rem;
        }
        @media (max-width: 968px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .runbook-content {
                margin-left: 0;
                max-width: 100%;
                padding: 2rem 1.5rem;
            }
            .menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .architecture-diagram { font-size: 0.6rem; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fab fa-whatsapp"></i>
            <span>WhatsApp Medic Scheduler</span>
        </div>
        <div class="nav-links">
            <a href="index.html">InÃ­cio</a>
            <a href="api.html">API Reference</a>
            <a href="agent.html">Agent IA</a>
            <a href="mock-gateway.html">Mock Gateway</a>
            <a href="technical.html" class="active">Technical</a>
            <a href="lgpd.html">LGPD</a>
            <a href="runbook.html">Runbook</a>
            <a href="https://github.com/ualers2/WhatsAppMedicSheduler" target="_blank">GitHub</a>
        </div>
    </nav>

    <div class="runbook-layout">
        <!-- Sidebar Menu -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-book"></i> Menu do Runbook</h3>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#prerequisitos"><i class="fas fa-clipboard-check"></i> PrÃ©-requisitos</a></li>
                <li><a href="#arquitetura"><i class="fas fa-sitemap"></i> Arquitetura</a></li>
                <li><a href="#instalacao"><i class="fas fa-download"></i> InstalaÃ§Ã£o</a></li>
                <li><a href="#configuracao"><i class="fas fa-cog"></i> ConfiguraÃ§Ã£o</a></li>
                <li><a href="#docker"><i class="fab fa-docker"></i> Deploy Docker</a></li>
                <li><a href="#servicos"><i class="fas fa-server"></i> ServiÃ§os e Portas</a></li>
                <li><a href="#databases"><i class="fas fa-database"></i> Bancos de Dados</a></li>
                <li><a href="#variaveis"><i class="fas fa-key"></i> VariÃ¡veis Ambiente</a></li>
                <li><a href="#healthcheck"><i class="fas fa-heartbeat"></i> Health Checks</a></li>
                <li><a href="#troubleshooting"><i class="fas fa-bug"></i> Troubleshooting</a></li>
                <li><a href="#operacoes"><i class="fas fa-tools"></i> OperaÃ§Ãµes Comuns</a></li>
                <li><a href="#monitoramento"><i class="fas fa-chart-line"></i> Monitoramento</a></li>
            </ul>
        </aside>

        <!-- Mobile Menu Toggle -->
        <button class="menu-toggle" id="menuToggle" aria-label="Toggle Menu">
            <i class="fas fa-bars"></i>
        </button>

        <main class="runbook-content">
            <div class="runbook-header">
                <h1><i class="fas fa-book"></i> Runbook</h1>
                <p>Guia Completo de InstalaÃ§Ã£o, ConfiguraÃ§Ã£o e OperaÃ§Ã£o do WhatsApp Medic Scheduler</p>
            </div>

        <!-- 1. PrÃ©-requisitos -->
        <section id="prerequisitos" class="section">
            <h2>1. PrÃ©-requisitos</h2>
            
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon"><i class="fas fa-laptop-code"></i></div>
                        <h3>Software NecessÃ¡rio</h3>
                    </div>
                    <ul class="checklist">
                        <li><strong>Python 3.11+</strong> - Runtime principal</li>
                        <li><strong>Docker 24+</strong> - ContainerizaÃ§Ã£o</li>
                        <li><strong>Docker Compose 2.x</strong> - OrquestraÃ§Ã£o</li>
                        <li><strong>Git</strong> - Controle de versÃ£o</li>
                        <li><strong>curl</strong> - Testes de API</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon"><i class="fas fa-key"></i></div>
                        <h3>Credenciais NecessÃ¡rias</h3>
                    </div>
                    <ul class="checklist">
                        <li><strong>OpenAI API Key</strong> - Agente de IA</li>
                        <li><strong>Vonage/Twilio</strong> - WhatsApp API</li>
                        <li><strong>AgentOps Key</strong> - Monitoramento (opcional)</li>
                        <li><strong>SMTP</strong> - NotificaÃ§Ãµes por email</li>
                    </ul>
                </div>
            </div>

            <h3>Verificar InstalaÃ§Ãµes</h3>
            <div class="code-block"><code># Python
python --version
# Esperado: Python 3.11.x

# Docker
docker --version
# Esperado: Docker version 24.x.x

# Docker Compose
docker compose version
# Esperado: Docker Compose version v2.x.x

# Git
git --version</code></div>

            <div class="alert alert-info">
                <strong>ğŸ’¡ Dica:</strong> No Windows, recomendamos usar WSL2 com Docker Desktop para melhor performance.
            </div>
        </section>

        <!-- 2. Arquitetura -->
        <section id="arquitetura" class="section">
            <h2>2. Arquitetura do Sistema</h2>

            <div class="architecture-diagram">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           WhatsApp Medic Scheduler                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   WhatsApp   â”‚     â”‚                BACKEND (Flask/ASGI)              â”‚     â”‚
â”‚   â”‚   (Vonage/   â”‚â”€â”€â”€â”€â–¶â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚
â”‚   â”‚   Twilio)    â”‚     â”‚  â”‚  webhooks.py    â”‚  â”‚      api.py         â”‚   â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚  Port: 3004     â”‚  â”‚     Port: 3000      â”‚   â”‚     â”‚
â”‚                        â”‚  â”‚  â€¢ /twilio      â”‚  â”‚  â€¢ /messages        â”‚   â”‚     â”‚
â”‚                        â”‚  â”‚  â€¢ /vonage      â”‚  â”‚  â€¢ /agent           â”‚   â”‚     â”‚
â”‚                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â€¢ /fallback        â”‚   â”‚     â”‚
â”‚                        â”‚           â”‚           â”‚  â€¢ /rag             â”‚   â”‚     â”‚
â”‚                        â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚
â”‚                        â”‚                      â–¼           â”‚              â”‚     â”‚
â”‚                        â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚              â”‚     â”‚
â”‚                        â”‚           â”‚   Agent IA (GPT-4)  â”‚â”‚              â”‚     â”‚
â”‚                        â”‚           â”‚   + Guardrails      â”‚â”‚              â”‚     â”‚
â”‚                        â”‚           â”‚   + Tools           â”‚â”‚              â”‚     â”‚
â”‚                        â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚              â”‚     â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                           â”‚                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                        INFRAESTRUTURA                 â”‚                 â”‚  â”‚
â”‚   â”‚                                          â–¼            â”‚                 â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚   â”‚  â”‚  PostgreSQL   â”‚  â”‚    MongoDB    â”‚  â”‚     Redis     â”‚               â”‚  â”‚
â”‚   â”‚  â”‚  Port: 5122   â”‚  â”‚  Port: 29017  â”‚  â”‚  Port: 6319   â”‚               â”‚  â”‚
â”‚   â”‚  â”‚  â€¢ Pacientes  â”‚  â”‚  â€¢ Auditoria  â”‚  â”‚  â€¢ Cache      â”‚               â”‚  â”‚
â”‚   â”‚  â”‚  â€¢ Schedules  â”‚  â”‚  â€¢ Logs       â”‚  â”‚  â€¢ Dedup      â”‚               â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚   â”‚                                                                         â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â”‚
â”‚   â”‚  â”‚  Net Mock API Gateway       â”‚  â”‚       PgAdmin               â”‚      â”‚  â”‚
â”‚   â”‚  â”‚  Port: 5001                 â”‚  â”‚      Port: 5050             â”‚      â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>

            <h3>Componentes Principais</h3>
            <div class="grid-3">
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-globe"></i> API Principal</div>
                    <p>Flask + ASGI/Uvicorn</p>
                    <p class="service-port">Port: 3000</p>
                    <p>5 workers, 800MB RAM</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-envelope"></i> Webhooks</div>
                    <p>Flask + ASGI/Uvicorn</p>
                    <p class="service-port">Port: 3004</p>
                    <p>5 workers, 800MB RAM</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-hospital"></i> Mock Gateway</div>
                    <p>Flask + Flasgger</p>
                    <p class="service-port">Port: 5001</p>
                    <p>Simula API NetPACS</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-database"></i> PostgreSQL</div>
                    <p>VersÃ£o 15</p>
                    <p class="service-port">Port: 5122</p>
                    <p>Dados principais</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-leaf"></i> MongoDB</div>
                    <p>VersÃ£o 7</p>
                    <p class="service-port">Port: 29017</p>
                    <p>Auditoria e logs</p>
                </div>
                <div class="service-card">
                    <div class="service-name"><i class="fas fa-bolt"></i> Redis</div>
                    <p>VersÃ£o 7 Alpine</p>
                    <p class="service-port">Port: 6319</p>
                    <p>Cache e dedup</p>
                </div>
            </div>
        </section>

        <!-- 3. InstalaÃ§Ã£o -->
        <section id="instalacao" class="section">
            <h2>3. InstalaÃ§Ã£o</h2>

            <h3>3.1 InstalaÃ§Ã£o RÃ¡pida (Docker)</h3>
            
            <div class="step">
                <div class="step-number">1</div>
                <div>
                    <h4>Clonar RepositÃ³rio</h4>
                    <div class="code-block"><code>git clone https://github.com/ualers2/WhatsAppMedicSheduler.git
cd WhatsAppMedicSheduler</code></div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div>
                    <h4>Configurar VariÃ¡veis de Ambiente</h4>
                    <div class="code-block"><code># Copiar template de variÃ¡veis
cp project/master.env.example project/master.env

# Editar com suas credenciais
code project/master.env  # ou nano/vim</code></div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div>
                    <h4>Build da Imagem Base</h4>
                    <div class="code-block"><code># Construir imagem base com variÃ¡veis de ambiente
cd project
docker compose up --build -d
cd ..</code></div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <div>
                    <h4>Subir Todos os ServiÃ§os</h4>
                    <div class="code-block"><code># Na raiz do projeto
docker compose up -d

# Verificar status
docker compose ps</code></div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">5</div>
                <div>
                    <h4>Inicializar Banco de Dados</h4>
                    <div class="code-block"><code># Executar migraÃ§Ãµes
docker compose exec api_medicsheduler python migrations/run_all_migrations.py

# Popular dados iniciais (mock)
docker compose exec api_medicsheduler python migrations/init_mock_database.py</code></div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">6</div>
                <div>
                    <h4>Verificar InstalaÃ§Ã£o</h4>
                    <div class="code-block"><code># Health check da API
curl http://localhost:3000/rag/health

# Health check Mock Gateway
curl http://localhost:5001/health

# Listar containers
docker compose ps</code></div>
                </div>
            </div>

            <div class="alert alert-success">
                <strong>âœ… Sucesso!</strong> Se todos os health checks retornarem status OK, o sistema estÃ¡ funcionando.
            </div>

            <h3>3.2 InstalaÃ§Ã£o Local (Desenvolvimento)</h3>
            <div class="code-block"><code># Criar ambiente virtual
python -m venv venv

# Ativar ambiente
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# Instalar dependÃªncias do backend
pip install -r backend/requirements.txt

# Instalar dependÃªncias do Mock Gateway
pip install -r net_mock_api_gateway/requirements.txt

# Copiar variÃ¡veis de ambiente
cp project/master.env backend/app/keys/master.env

# Subir apenas infraestrutura (PostgreSQL, MongoDB, Redis)
docker compose up -d postgres_medicsheduler mongodb_medicsheduler redis_medicsheduler

# Rodar API localmente
cd backend
python api.py</code></div>
        </section>

        <!-- 4. ConfiguraÃ§Ã£o -->
        <section id="configuracao" class="section">
            <h2>4. ConfiguraÃ§Ã£o</h2>

            <h3>4.1 Arquivo master.env</h3>
            <p>O arquivo <code class="inline-code">project/master.env</code> centraliza todas as configuraÃ§Ãµes:</p>

            <div class="card">
                <h4><i class="fas fa-globe"></i> URLs e Modo de API</h4>
                <div class="code-block"><code># Modo Mock (desenvolvimento)
USE_MOCK_API=true
URL_BASE=https://seu-dominio.rshare.io

# URLs da API de HomologaÃ§Ã£o (AnimatiPACS)
ANIMATI_PACS_MOCK_URL=http://net_mock_api_gateway:5001/api-gateway
ANIMATI_PACS_SANDBOX_URL=https://int.public.animatipacs.com.br/api-gateway
ANIMATI_PACS_PRODUCTION_URL=https://ris.clinicasaojose.med.br/api-gateway</code></div>
            </div>

            <div class="card">
                <h4><i class="fas fa-key"></i> Credenciais de API</h4>
                <div class="code-block"><code># OpenAI (obrigatÃ³rio)
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxx

# AgentOps (monitoramento de agente)
AGENTOPS_API_KEY=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# AnimatiPACS API Keys
ANIMATI_PACS_MOCK_API_KEY=eyJhbGciOiJIUzI1NiIs...
ANIMATI_PACS_SANDBOX_API_KEY=eyJhbGciOiJIUzI1NiJ9...
ANIMATI_PACS_PRODUCTION_API_KEY=eyJhbGciOiJIUzI1NiJ9...</code></div>
            </div>

            <div class="card">
                <h4><i class="fab fa-whatsapp"></i> WhatsApp (Vonage/Twilio)</h4>
                <div class="code-block"><code># Vonage
VONAGE_API_KEY=xxxxxxxx
VONAGE_API_SECRET=xxxxxxxxxxxx
VONAGE_APPLICATION_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
VONAGE_APPLICATION_PRIVATE_KEY=C:\path\to\private.key
VONAGE_SIGNATURE_SECRET=xxxxxxxxxxxxxxxxx
VONAGE_NUMBER=14157386102

# Twilio
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_NUMBER=whatsapp:+14155238886</code></div>
            </div>

            <div class="card">
                <h4><i class="fas fa-database"></i> Bancos de Dados</h4>
                <div class="code-block"><code># PostgreSQL
DATABASE_URL=postgresql://postgres:postgres@postgres_medicsheduler:5432/meubanco

# MongoDB
MONGO_URI=mongodb://root:rootpassword@mongodb_medicsheduler:27017/audit_and_logs?authSource=admin
MONGO_DB_NAME=audit_and_logs

# Redis
REDIS_URL=redis://redis_medicsheduler:6379/0</code></div>
            </div>

            <div class="alert alert-warning">
                <strong>âš ï¸ Importante:</strong> Nunca commite o arquivo <code class="inline-code">master.env</code> com credenciais reais. Use <code class="inline-code">.gitignore</code> para protegÃª-lo.
            </div>
        </section>

        <!-- 5. Docker -->
        <section id="docker" class="section">
            <h2>5. Deploy com Docker</h2>

            <h3>5.1 Estrutura de Imagens</h3>
            <table>
                <thead>
                    <tr>
                        <th>Imagem</th>
                        <th>Base</th>
                        <th>PropÃ³sito</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code class="inline-code">mediacutstudio/whatsapp-medic-scheduler:v1.0</code></td>
                        <td>python:3.11-slim</td>
                        <td>Imagem base com master.env</td>
                    </tr>
                    <tr>
                        <td><code class="inline-code">mediacutstudio/api-medicsheduler:v1.0</code></td>
                        <td>Imagem base</td>
                        <td>API Principal</td>
                    </tr>
                    <tr>
                        <td><code class="inline-code">mediacutstudio/webhooks-medicsheduler:v1.0</code></td>
                        <td>Imagem base</td>
                        <td>Webhooks WhatsApp</td>
                    </tr>
                    <tr>
                        <td><code class="inline-code">mediacutstudio/net-mock-api-gateway:v1.0</code></td>
                        <td>Imagem base</td>
                        <td>Mock API Gateway</td>
                    </tr>
                </tbody>
            </table>

            <h3>5.2 Comandos Docker Essenciais</h3>
            
            <div class="card">
                <h4><i class="fas fa-hammer"></i> Build</h4>
                <table>
                    <tr>
                        <td>Build todas as imagens</td>
                        <td><code class="inline-code">docker compose build</code></td>
                    </tr>
                    <tr>
                        <td>Build com cache limpo</td>
                        <td><code class="inline-code">docker compose build --no-cache</code></td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h4><i class="fas fa-play"></i> Iniciar / Parar</h4>
                <table>
                    <tr>
                        <td>Subir todos os serviÃ§os</td>
                        <td><code class="inline-code">docker compose up -d</code></td>
                    </tr>
                    <tr>
                        <td>Subir serviÃ§o especÃ­fico</td>
                        <td><code class="inline-code">docker compose up -d api_medicsheduler</code></td>
                    </tr>
                    <tr>
                        <td>Parar todos os serviÃ§os</td>
                        <td><code class="inline-code">docker compose down</code></td>
                    </tr>
                    <tr>
                        <td>Parar e remover volumes</td>
                        <td><code class="inline-code">docker compose down -v</code></td>
                    </tr>
                    <tr>
                        <td>Reiniciar serviÃ§o</td>
                        <td><code class="inline-code">docker compose restart api_medicsheduler</code></td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h4><i class="fas fa-file-alt"></i> Logs</h4>
                <table>
                    <tr>
                        <td>Ver logs de todos os serviÃ§os</td>
                        <td><code class="inline-code">docker compose logs -f</code></td>
                    </tr>
                    <tr>
                        <td>Ver logs de serviÃ§o especÃ­fico</td>
                        <td><code class="inline-code">docker compose logs -f api_medicsheduler</code></td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h4><i class="fas fa-terminal"></i> ExecuÃ§Ã£o</h4>
                <table>
                    <tr>
                        <td>Executar comando no container</td>
                        <td><code class="inline-code">docker compose exec api_medicsheduler python --version</code></td>
                    </tr>
                    <tr>
                        <td>Acessar shell do container</td>
                        <td><code class="inline-code">docker compose exec api_medicsheduler bash</code></td>
                    </tr>
                </table>
            </div>

            <h3>5.3 Limites de Recursos</h3>
            <table>
                <thead>
                    <tr>
                        <th>ServiÃ§o</th>
                        <th>MemÃ³ria</th>
                        <th>CPU</th>
                        <th>Workers</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>api_medicsheduler</td>
                        <td>800MB</td>
                        <td>1.25</td>
                        <td>5</td>
                    </tr>
                    <tr>
                        <td>webhooks_medicsheduler</td>
                        <td>800MB</td>
                        <td>0.80</td>
                        <td>5</td>
                    </tr>
                    <tr>
                        <td>net_mock_api_gateway</td>
                        <td>800MB</td>
                        <td>1.25</td>
                        <td>1</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- 6. ServiÃ§os e Portas -->
        <section id="servicos" class="section">
            <h2>6. ServiÃ§os e Portas</h2>

            <table>
                <thead>
                    <tr>
                        <th>ServiÃ§o</th>
                        <th>Porta Host</th>
                        <th>Porta Container</th>
                        <th>URL de Acesso</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>API Principal</td>
                        <td>3000</td>
                        <td>3000</td>
                        <td><code class="inline-code">http://localhost:3000</code></td>
                    </tr>
                    <tr>
                        <td>Webhooks</td>
                        <td>3004</td>
                        <td>3004</td>
                        <td><code class="inline-code">http://localhost:3004</code></td>
                    </tr>
                    <tr>
                        <td>Mock API Gateway</td>
                        <td>5001</td>
                        <td>5001</td>
                        <td><code class="inline-code">http://localhost:5001</code></td>
                    </tr>
                    <tr>
                        <td>PostgreSQL</td>
                        <td>5122</td>
                        <td>5432</td>
                        <td><code class="inline-code">localhost:5122</code></td>
                    </tr>
                    <tr>
                        <td>MongoDB</td>
                        <td>29017</td>
                        <td>27017</td>
                        <td><code class="inline-code">localhost:29017</code></td>
                    </tr>
                    <tr>
                        <td>Redis</td>
                        <td>6319</td>
                        <td>6379</td>
                        <td><code class="inline-code">localhost:6319</code></td>
                    </tr>
                    <tr>
                        <td>PgAdmin</td>
                        <td>5050</td>
                        <td>80</td>
                        <td><code class="inline-code">http://localhost:5050</code></td>
                    </tr>
                </tbody>
            </table>

            <h3>URLs Swagger (DocumentaÃ§Ã£o Interativa)</h3>
            <div class="grid-3">
                <div class="card">
                    <h4>API Principal</h4>
                    <p><a href="http://localhost:3000/apidocs" target="_blank">http://localhost:3000/apidocs</a></p>
                </div>
                <div class="card">
                    <h4>Webhooks</h4>
                    <p><a href="http://localhost:3004/apidocs" target="_blank">http://localhost:3004/apidocs</a></p>
                </div>
                <div class="card">
                    <h4>Mock Gateway</h4>
                    <p><a href="http://localhost:5001/apidocs" target="_blank">http://localhost:5001/apidocs</a></p>
                </div>
            </div>
        </section>

        <!-- 7. Bancos de Dados -->
        <section id="databases" class="section">
            <h2>7. Bancos de Dados</h2>

            <h3>7.1 PostgreSQL</h3>
            <div class="card">
                <h4>ConexÃ£o</h4>
                <table>
                    <tr>
                        <td><strong>Via Docker</strong></td>
                        <td><code class="inline-code">docker compose exec postgres_medicsheduler psql -U postgres -d meubanco</code></td>
                    </tr>
                    <tr>
                        <td><strong>Via cliente local</strong></td>
                        <td><code class="inline-code">psql -h localhost -p 5122 -U postgres -d meubanco</code></td>
                    </tr>
                    <tr>
                        <td><strong>String de conexÃ£o</strong></td>
                        <td><code class="inline-code">postgresql://postgres:postgres@localhost:5122/meubanco</code></td>
                    </tr>
                </table>

                <h4>Credenciais PadrÃ£o</h4>
                <table>
                    <tr><td>Host</td><td>localhost</td></tr>
                    <tr><td>Porta</td><td>5122</td></tr>
                    <tr><td>Database</td><td>meubanco</td></tr>
                    <tr><td>UsuÃ¡rio</td><td>postgres</td></tr>
                    <tr><td>Senha</td><td>postgres</td></tr>
                </table>
            </div>

            <h3>7.2 MongoDB</h3>
            <div class="card">
                <h4>ConexÃ£o</h4>
                <table>
                    <tr>
                        <td><strong>Via Docker</strong></td>
                        <td><code class="inline-code">docker compose exec mongodb_medicsheduler mongosh -u root -p rootpassword</code></td>
                    </tr>
                    <tr>
                        <td><strong>String de conexÃ£o</strong></td>
                        <td><code class="inline-code">mongodb://root:rootpassword@localhost:29017/audit_and_logs?authSource=admin</code></td>
                    </tr>
                </table>

                <h4>Collections Principais</h4>
                <ul>
                    <li><code class="inline-code">audit_logs</code> - Logs de auditoria</li>
                    <li><code class="inline-code">conversation_history</code> - HistÃ³rico de conversas</li>
                    <li><code class="inline-code">agent_sessions</code> - SessÃµes do agente</li>
                </ul>
            </div>

            <h3>7.3 Redis</h3>
            <div class="card">
                <h4>ConexÃ£o</h4>
                <table>
                    <tr>
                        <td><strong>Via Docker</strong></td>
                        <td><code class="inline-code">docker compose exec redis_medicsheduler redis-cli</code></td>
                    </tr>
                    <tr>
                        <td><strong>Via cliente local</strong></td>
                        <td><code class="inline-code">redis-cli -h localhost -p 6319</code></td>
                    </tr>
                    <tr>
                        <td><strong>String de conexÃ£o</strong></td>
                        <td><code class="inline-code">redis://localhost:6319/0</code></td>
                    </tr>
                </table>

                <h4>Uso Principal</h4>
                <ul>
                    <li>Cache de sessÃµes</li>
                    <li>DeduplicaÃ§Ã£o de mensagens (TTL 5 min)</li>
                    <li>Filas de processamento</li>
                </ul>
            </div>

            <h3>7.4 PgAdmin</h3>
            <div class="card">
                <p>Interface web para gerenciar PostgreSQL:</p>
                <p><strong>URL:</strong> <a href="http://localhost:5050" target="_blank">http://localhost:5050</a></p>
                <table>
                    <tr><td>Email</td><td>admin@example.com</td></tr>
                    <tr><td>Senha</td><td>pgadmin_medicsheduler_admin_key</td></tr>
                </table>
            </div>
        </section>

        <!-- 8. VariÃ¡veis de Ambiente -->
        <section id="variaveis" class="section">
            <h2>8. VariÃ¡veis de Ambiente</h2>

            <h3>ReferÃªncia Completa</h3>
            <div class="card">
                <h4><i class="fas fa-lock"></i> AutenticaÃ§Ã£o</h4>
                <div class="env-var">
                    <span class="env-key">OPENAI_API_KEY</span>
                    <span class="env-desc">Chave da API OpenAI (obrigatÃ³rio)</span>
                </div>
                <div class="env-var">
                    <span class="env-key">AGENTOPS_API_KEY</span>
                    <span class="env-desc">Chave AgentOps para monitoramento</span>
                </div>
                <div class="env-var">
                    <span class="env-key">ANIMATI_PACS_MOCK_API_KEY</span>
                    <span class="env-desc">JWT para Mock API Gateway</span>
                </div>
                <div class="env-var">
                    <span class="env-key">ANIMATI_PACS_SANDBOX_API_KEY</span>
                    <span class="env-desc">JWT para ambiente de homologaÃ§Ã£o</span>
                </div>
                <div class="env-var">
                    <span class="env-key">ANIMATI_PACS_PRODUCTION_API_KEY</span>
                    <span class="env-desc">JWT para ambiente de produÃ§Ã£o</span>
                </div>
            </div>

            <div class="card">
                <h4><i class="fab fa-whatsapp"></i> WhatsApp - Vonage</h4>
                <div class="env-var">
                    <span class="env-key">VONAGE_API_KEY</span>
                    <span class="env-desc">API Key Vonage</span>
                </div>
                <div class="env-var">
                    <span class="env-key">VONAGE_API_SECRET</span>
                    <span class="env-desc">API Secret Vonage</span>
                </div>
                <div class="env-var">
                    <span class="env-key">VONAGE_APPLICATION_ID</span>
                    <span class="env-desc">ID da aplicaÃ§Ã£o Vonage</span>
                </div>
                <div class="env-var">
                    <span class="env-key">VONAGE_APPLICATION_PRIVATE_KEY</span>
                    <span class="env-desc">Caminho para chave privada</span>
                </div>
                <div class="env-var">
                    <span class="env-key">VONAGE_SIGNATURE_SECRET</span>
                    <span class="env-desc">Secret para validaÃ§Ã£o de assinatura</span>
                </div>
            </div>

            <div class="card">
                <h4><i class="fas fa-server"></i> Infraestrutura</h4>
                <div class="env-var">
                    <span class="env-key">DATABASE_URL</span>
                    <span class="env-desc">URL conexÃ£o PostgreSQL</span>
                </div>
                <div class="env-var">
                    <span class="env-key">MONGO_URI</span>
                    <span class="env-desc">URL conexÃ£o MongoDB</span>
                </div>
                <div class="env-var">
                    <span class="env-key">MONGO_DB_NAME</span>
                    <span class="env-desc">Nome do database MongoDB</span>
                </div>
                <div class="env-var">
                    <span class="env-key">REDIS_URL</span>
                    <span class="env-desc">URL conexÃ£o Redis</span>
                </div>
            </div>

            <div class="card">
                <h4><i class="fas fa-cog"></i> Sistema</h4>
                <div class="env-var">
                    <span class="env-key">USE_MOCK_API</span>
                    <span class="env-desc">true/false - Usar Mock ou ProduÃ§Ã£o</span>
                </div>
                <div class="env-var">
                    <span class="env-key">URL_BASE</span>
                    <span class="env-desc">URL base pÃºblica (webhook)</span>
                </div>
                <div class="env-var">
                    <span class="env-key">FLASK_ENV</span>
                    <span class="env-desc">development/production</span>
                </div>
                <div class="env-var">
                    <span class="env-key">MAX_TOKENS_LIMIT</span>
                    <span class="env-desc">Limite mÃ¡ximo de tokens (300000)</span>
                </div>
            </div>
        </section>

        <!-- 9. Health Checks -->
        <section id="healthcheck" class="section">
            <h2>9. Health Checks</h2>

            <h3>Endpoints de Health</h3>
            <div class="code-block"><code># API Principal
curl http://localhost:3000/rag/health
# Esperado: {"status": "healthy", ...}

# Webhooks
curl http://localhost:3004/health
# Esperado: {"status": "ok"}

# Mock API Gateway  
curl http://localhost:5001/health
# Esperado: {"status": "healthy", "version": "3.98.2"}

# PostgreSQL (via container)
docker compose exec postgres_medicsheduler pg_isready -U postgres
# Esperado: localhost:5432 - accepting connections

# Redis
docker compose exec redis_medicsheduler redis-cli ping
# Esperado: PONG

# MongoDB
docker compose exec mongodb_medicsheduler mongosh --eval "db.adminCommand('ping')"
# Esperado: { ok: 1 }</code></div>
        </section>

        <!-- 10. Troubleshooting -->
        <section id="troubleshooting" class="section">
            <h2>10. Troubleshooting</h2>

            <div class="card">
                <h3><i class="fas fa-exclamation-circle" style="color: var(--method-delete);"></i> Container nÃ£o inicia</h3>
                <div class="code-block"><code># Ver logs do container
docker compose logs api_medicsheduler

# Ver eventos do container
docker events --filter container=api_medicsheduler

# Verificar recursos
docker stats --no-stream</code></div>
                <p><strong>Causas comuns:</strong></p>
                <ul>
                    <li>Porta jÃ¡ em uso</li>
                    <li>MemÃ³ria insuficiente</li>
                    <li>Imagem base nÃ£o encontrada</li>
                </ul>
            </div>

            <div class="card">
                <h3><i class="fas fa-exclamation-circle" style="color: var(--method-delete);"></i> Erro de conexÃ£o com banco</h3>
                <div class="code-block"><code># Verificar se PostgreSQL estÃ¡ rodando
docker compose ps postgres_medicsheduler

# Testar conexÃ£o
docker compose exec postgres_medicsheduler pg_isready -U postgres

# Ver logs do PostgreSQL
docker compose logs postgres_medicsheduler</code></div>
                <p><strong>SoluÃ§Ãµes:</strong></p>
                <ul>
                    <li>Verificar DATABASE_URL no master.env</li>
                    <li>Confirmar que container PostgreSQL estÃ¡ healthy</li>
                    <li>Verificar se rede Docker estÃ¡ correta</li>
                </ul>
            </div>

            <div class="card">
                <h3><i class="fas fa-exclamation-circle" style="color: var(--method-delete);"></i> Limpar tudo e recomeÃ§ar</h3>
                <div class="code-block"><code># Parar todos os containers
docker compose down

# Remover volumes (CUIDADO: apaga dados!)
docker compose down -v

# Remover imagens do projeto
docker rmi $(docker images -q mediacutstudio/*)

# Limpar cache Docker
docker system prune -af

# Reconstruir do zero
docker compose build --no-cache
docker compose up -d</code></div>
            </div>
        </section>

        <!-- 11. OperaÃ§Ãµes Comuns -->
        <section id="operacoes" class="section">
            <h2>11. OperaÃ§Ãµes Comuns</h2>

            <h3>Backup e Restore</h3>
            <div class="card">
                <h4>Backup PostgreSQL</h4>
                <div class="code-block"><code># Backup completo
docker compose exec postgres_medicsheduler pg_dump -U postgres meubanco > backup.sql

# Backup compactado
docker compose exec postgres_medicsheduler pg_dump -U postgres meubanco | gzip > backup.sql.gz

# Restore
cat backup.sql | docker compose exec -T postgres_medicsheduler psql -U postgres -d meubanco</code></div>
            </div>

            <div class="card">
                <h4>Backup MongoDB</h4>
                <div class="code-block"><code># Backup
docker compose exec mongodb_medicsheduler mongodump -u root -p rootpassword --authenticationDatabase admin -d audit_and_logs --out /data/backup

# Copiar para host
docker cp mongodb_medicsheduler:/data/backup ./mongo_backup

# Restore
docker compose exec mongodb_medicsheduler mongorestore -u root -p rootpassword --authenticationDatabase admin /data/backup</code></div>
            </div>

            <h3>AtualizaÃ§Ã£o do Sistema</h3>
            <div class="card">
                <div class="code-block"><code># Pull das Ãºltimas mudanÃ§as
git pull origin main

# Rebuild das imagens
docker compose build

# Reiniciar serviÃ§os
docker compose up -d

# Executar migraÃ§Ãµes (se houver)
docker compose exec api_medicsheduler python migrations/run_all_migrations.py</code></div>
            </div>

            <h3>Executar Migrations</h3>
            <div class="card">
                <div class="code-block"><code># Executar todas as migraÃ§Ãµes
docker compose exec api_medicsheduler python migrations/run_all_migrations.py

# MigraÃ§Ãµes especÃ­ficas
docker compose exec api_medicsheduler python migrations/001_create_fallback_tables.py
docker compose exec api_medicsheduler python migrations/002_populate_convenios.py
docker compose exec api_medicsheduler python migrations/003_populate_plano_convenios.py

# Recriar mock database
docker compose exec api_medicsheduler python migrations/rebuild_mock_database.py</code></div>
            </div>
        </section>

        <!-- 12. Monitoramento -->
        <section id="monitoramento" class="section">
            <h2>12. Monitoramento</h2>

            <h3>Logs</h3>
            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>DescriÃ§Ã£o</th>
                            <th>Comando</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Logs em tempo real (todos)</td>
                            <td><code class="inline-code">docker compose logs -f</code></td>
                        </tr>
                        <tr>
                            <td>Logs de serviÃ§o especÃ­fico</td>
                            <td><code class="inline-code">docker compose logs -f api_medicsheduler</code></td>
                        </tr>
                        <tr>
                            <td>Ãšltimas 100 linhas</td>
                            <td><code class="inline-code">docker compose logs --tail 100 api_medicsheduler</code></td>
                        </tr>
                        <tr>
                            <td>Logs com timestamp</td>
                            <td><code class="inline-code">docker compose logs -f -t api_medicsheduler</code></td>
                        </tr>
                        <tr>
                            <td>Logs salvos (volumes)</td>
                            <td><code class="inline-code">ls -la backend/logs/</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>MÃ©tricas de Container</h3>
            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>DescriÃ§Ã£o</th>
                            <th>Comando</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>CPU, memÃ³ria, rede (tempo real)</td>
                            <td><code class="inline-code">docker stats</code></td>
                        </tr>
                        <tr>
                            <td>Apenas serviÃ§os especÃ­ficos</td>
                            <td><code class="inline-code">docker stats api_medicsheduler webhooks_medicsheduler</code></td>
                        </tr>
                        <tr>
                            <td>Snapshot (sem streaming)</td>
                            <td><code class="inline-code">docker stats --no-stream</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>AgentOps (Monitoramento de Agente IA)</h3>
            <div class="card">
                <p>O sistema usa AgentOps para monitorar execuÃ§Ãµes do agente de IA.</p>
                <p><strong>Dashboard:</strong> <a href="https://app.agentops.ai" target="_blank">https://app.agentops.ai</a></p>
                <ul>
                    <li>Rastreamento de sessÃµes do agente</li>
                    <li>MÃ©tricas de uso de tokens</li>
                    <li>AnÃ¡lise de chamadas de tools</li>
                    <li>Debugging de conversas</li>
                </ul>
            </div>

            <h3>Swagger UI (DocumentaÃ§Ã£o de API)</h3>
            <div class="grid-3">
                <div class="card">
                    <h4>API Principal</h4>
                    <p><a href="http://localhost:3000/apidocs" target="_blank">localhost:3000/apidocs</a></p>
                </div>
                <div class="card">
                    <h4>Webhooks</h4>
                    <p><a href="http://localhost:3004/apidocs" target="_blank">localhost:3004/apidocs</a></p>
                </div>
                <div class="card">
                    <h4>Mock Gateway</h4>
                    <p><a href="http://localhost:5001/apidocs" target="_blank">localhost:5001/apidocs</a></p>
                </div>
            </div>

            <h3>Alertas por Email</h3>
            <div class="card">
                <p>O sistema envia alertas por email em caso de falhas crÃ­ticas.</p>
                <p>Configure no <code class="inline-code">master.env</code>:</p>
                <div class="code-block"><code>SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=seu-email@gmail.com
SMTP_PASSWORD=xxxx xxxx xxxx xxxx
ADMIN_EMAIL_LIST=admin@exemplo.com,dev@exemplo.com</code></div>
            </div>
        </section>

        <footer class="runbook-footer">
            <p><i class="fas fa-book"></i> Runbook - WhatsApp Medic Scheduler v2.0</p>
            <p>Ãšltima atualizaÃ§Ã£o: Dezembro 2025</p>
        </footer>
        </main>
    </div>

    <script>
        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            const icon = menuToggle.querySelector('i');
            icon.classList.toggle('fa-bars');
            icon.classList.toggle('fa-times');
        });

        // Close sidebar when clicking a link (mobile)
        document.querySelectorAll('.sidebar-menu a').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 968) {
                    sidebar.classList.remove('active');
                    const icon = menuToggle.querySelector('i');
                    icon.classList.add('fa-bars');
                    icon.classList.remove('fa-times');
                }
            });
        });

        // Highlight active section on scroll
        const sections = document.querySelectorAll('section[id]');
        const menuLinks = document.querySelectorAll('.sidebar-menu a');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 150;
                if (scrollY >= sectionTop) {
                    current = section.getAttribute('id');
                }
            });

            menuLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });

        });
    </script>
    <script src="js/main.js"></script>
</body>
</html>
