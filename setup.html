<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Guide - WhatsApp Medic Scheduler</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fab fa-whatsapp"></i>
            <span>WhatsApp Medic Scheduler</span>
        </div>
        <ul class="nav-links">
            <li><a href="index.html">Início</a></li>
            <li><a href="api.html">API Reference</a></li>
            <li><a href="agent.html">Agent IA</a></li>
            <li><a href="setup.html" class="active">Setup</a></li>
            <li><a href="https://github.com/ualers2/WhatsAppMedicSheduler" target="_blank"><i class="fab fa-github"></i></a></li>
        </ul>
    </nav>

    <!-- Page Header -->
    <header class="page-header">
        <h1><i class="fas fa-cogs"></i> Setup Guide</h1>
        <p>Guia completo de instalação e configuração</p>
    </header>

    <!-- Main Content -->
    <div class="docs-container">
        <!-- Sidebar -->
        <aside class="docs-sidebar">
            <div class="sidebar-section">
                <h4>Instalação</h4>
                <ul>
                    <li><a href="#requirements">Requisitos</a></li>
                    <li><a href="#clone">Clonar Repositório</a></li>
                    <li><a href="#docker">Docker Setup</a></li>
                    <li><a href="#manual">Setup Manual</a></li>
                </ul>
            </div>
            <div class="sidebar-section">
                <h4>Configuração</h4>
                <ul>
                    <li><a href="#env">Variáveis de Ambiente</a></li>
                    <li><a href="#database">Banco de Dados</a></li>
                    <li><a href="#whatsapp">WhatsApp API</a></li>
                    <li><a href="#ai">Configuração de IA</a></li>
                </ul>
            </div>
            <div class="sidebar-section">
                <h4>Deploy</h4>
                <ul>
                    <li><a href="#production">Produção</a></li>
                    <li><a href="#monitoring">Monitoramento</a></li>
                </ul>
            </div>
        </aside>

        <!-- Content -->
        <main class="docs-content">
            <!-- Requirements -->
            <section id="requirements" class="doc-section">
                <h2>Requisitos do Sistema</h2>
                
                <div class="requirements-grid">
                    <div class="req-card">
                        <i class="fab fa-python"></i>
                        <h4>Python</h4>
                        <span>3.11+</span>
                    </div>
                    <div class="req-card">
                        <i class="fab fa-docker"></i>
                        <h4>Docker</h4>
                        <span>20.10+</span>
                    </div>
                    <div class="req-card">
                        <i class="fas fa-database"></i>
                        <h4>PostgreSQL</h4>
                        <span>14+</span>
                    </div>
                    <div class="req-card">
                        <i class="fas fa-server"></i>
                        <h4>Redis</h4>
                        <span>7+</span>
                    </div>
                </div>
            </section>

            <!-- Clone -->
            <section id="clone" class="doc-section">
                <h2>Clonar Repositório</h2>
                
                <div class="code-block">
                    <div class="code-header">
                        <span>Terminal</span>
                        <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                    </div>
                    <pre><code class="bash"># Clone o repositório
git clone https://github.com/ualers2/WhatsAppMedicSheduler.git

# Entre no diretório
cd WhatsAppMedicSheduler

# Copie o arquivo de ambiente
cp .env.example .env</code></pre>
                </div>
            </section>

            <!-- Docker -->
            <section id="docker" class="doc-section">
                <h2>Setup com Docker (Recomendado)</h2>
                
                <p>A maneira mais fácil de rodar o projeto é usando Docker Compose:</p>
                
                <div class="code-block">
                    <div class="code-header">
                        <span>Terminal</span>
                        <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                    </div>
                    <pre><code class="bash"># Construir e iniciar os containers
docker-compose up -d --build

# Verificar status dos containers
docker-compose ps

# Ver logs
docker-compose logs -f backend

# Parar os containers
docker-compose down</code></pre>
                </div>

                <h3>Serviços Disponíveis</h3>
                <table class="doc-table">
                    <thead>
                        <tr>
                            <th>Serviço</th>
                            <th>Porta</th>
                            <th>Descrição</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Backend API</td>
                            <td>5000</td>
                            <td>API principal Flask</td>
                        </tr>
                        <tr>
                            <td>API Gateway</td>
                            <td>5001</td>
                            <td>Mock API Gateway</td>
                        </tr>
                        <tr>
                            <td>PostgreSQL</td>
                            <td>5432</td>
                            <td>Banco de dados</td>
                        </tr>
                        <tr>
                            <td>Redis</td>
                            <td>6379</td>
                            <td>Cache e filas</td>
                        </tr>
                        <tr>
                            <td>MongoDB</td>
                            <td>27017</td>
                            <td>Logs e conversas</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Manual Setup -->
            <section id="manual" class="doc-section">
                <h2>Setup Manual</h2>
                
                <h3>1. Criar ambiente virtual</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span>Terminal</span>
                        <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                    </div>
                    <pre><code class="bash"># Criar venv
python -m venv venv

# Ativar (Windows)
.\venv\Scripts\activate

# Ativar (Linux/Mac)
source venv/bin/activate

# Instalar dependências
pip install -r backend/requirements.txt</code></pre>
                </div>

                <h3>2. Configurar banco de dados</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span>Terminal</span>
                        <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                    </div>
                    <pre><code class="bash"># Rodar migrações
cd backend
python -m migrations.run_all_migrations

# Popular dados de teste (opcional)
python -m scripts.init_mock_database</code></pre>
                </div>

                <h3>3. Iniciar servidor</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span>Terminal</span>
                        <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                    </div>
                    <pre><code class="bash"># Modo desenvolvimento
python api.py

# Ou com gunicorn (produção)
gunicorn -w 4 -b 0.0.0.0:5000 api:app</code></pre>
                </div>
            </section>

            <!-- Environment Variables -->
            <section id="env" class="doc-section">
                <h2>Variáveis de Ambiente</h2>
                
                <div class="code-block">
                    <div class="code-header">
                        <span>.env</span>
                        <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                    </div>
                    <pre><code class="bash"># ===========================================
# APLICAÇÃO
# ===========================================
FLASK_ENV=development
SECRET_KEY=sua_chave_secreta_muito_segura
DEBUG=true

# ===========================================
# BANCO DE DADOS
# ===========================================
DATABASE_URL=postgresql://user:password@localhost:5432/whatsapp_scheduler
REDIS_URL=redis://localhost:6379/0
MONGODB_URI=mongodb://localhost:27017/whatsapp_logs

# ===========================================
# WHATSAPP BUSINESS API
# ===========================================
WHATSAPP_VERIFY_TOKEN=seu_token_verificacao
WHATSAPP_ACCESS_TOKEN=seu_access_token
WHATSAPP_PHONE_NUMBER_ID=123456789
WHATSAPP_BUSINESS_ACCOUNT_ID=987654321

# ===========================================
# OPENAI / IA
# ===========================================
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxx
OPENAI_MODEL=gpt-4
OPENAI_TEMPERATURE=0.7

# ===========================================
# LGPD / SEGURANÇA
# ===========================================
ENCRYPTION_KEY=sua_chave_de_criptografia
DATA_RETENTION_DAYS=365
CONSENT_REQUIRED=true</code></pre>
                </div>

                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span><strong>Atenção:</strong> Nunca commite o arquivo .env no Git. Use .env.example como template.</span>
                </div>
            </section>

            <!-- WhatsApp Configuration -->
            <section id="whatsapp" class="doc-section">
                <h2>Configuração WhatsApp Business API</h2>
                
                <h3>1. Criar conta Meta Business</h3>
                <ol class="setup-steps">
                    <li>Acesse <a href="https://business.facebook.com" target="_blank">business.facebook.com</a></li>
                    <li>Crie uma conta Business se ainda não tiver</li>
                    <li>Vá em <strong>Configurações > WhatsApp</strong></li>
                    <li>Adicione um número de telefone</li>
                </ol>

                <h3>2. Configurar App no Meta for Developers</h3>
                <ol class="setup-steps">
                    <li>Acesse <a href="https://developers.facebook.com" target="_blank">developers.facebook.com</a></li>
                    <li>Crie um novo App do tipo "Business"</li>
                    <li>Adicione o produto "WhatsApp"</li>
                    <li>Copie o Access Token temporário ou gere um permanente</li>
                </ol>

                <h3>3. Configurar Webhook</h3>
                <ol class="setup-steps">
                    <li>Na configuração do WhatsApp, vá em "Webhook"</li>
                    <li>Insira sua URL: <code>https://seu-dominio.com/webhook</code></li>
                    <li>Insira o Verify Token (mesmo do .env)</li>
                    <li>Selecione os campos: <code>messages</code></li>
                </ol>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <span>Para desenvolvimento local, use <a href="https://ngrok.com" target="_blank">ngrok</a> para expor sua máquina à internet.</span>
                </div>
            </section>

            <!-- Production -->
            <section id="production" class="doc-section">
                <h2>Deploy em Produção</h2>
                
                <h3>Checklist de Produção</h3>
                <div class="checklist">
                    <label><input type="checkbox"> FLASK_ENV=production</label>
                    <label><input type="checkbox"> DEBUG=false</label>
                    <label><input type="checkbox"> Certificado SSL configurado</label>
                    <label><input type="checkbox"> Firewall configurado</label>
                    <label><input type="checkbox"> Backups automáticos do banco</label>
                    <label><input type="checkbox"> Monitoramento ativo</label>
                    <label><input type="checkbox"> Rate limiting configurado</label>
                    <label><input type="checkbox"> Logs configurados</label>
                </div>

                <h3>Docker em Produção</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span>Terminal</span>
                        <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                    </div>
                    <pre><code class="bash"># Build otimizado
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# Scale workers
docker-compose up -d --scale backend=3</code></pre>
                </div>
            </section>

            <!-- Monitoring -->
            <section id="monitoring" class="doc-section">
                <h2>Monitoramento</h2>
                
                <h3>Health Check</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span>Terminal</span>
                        <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                    </div>
                    <pre><code class="bash"># Verificar status da API
curl https://api.whatsappmedic.com/health

# Resposta esperada
{
  "status": "healthy",
  "version": "1.0.0",
  "components": {
    "database": "connected",
    "redis": "connected"
  }
}</code></pre>
                </div>

                <h3>Logs</h3>
                <p>Os logs são armazenados em <code>backend/logs/</code> e também no MongoDB para consulta histórica.</p>
                
                <div class="code-block">
                    <div class="code-header">
                        <span>Terminal</span>
                        <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                    </div>
                    <pre><code class="bash"># Ver logs em tempo real (Docker)
docker-compose logs -f backend

# Ver logs de erro
tail -f backend/logs/app/error.log</code></pre>
                </div>
            </section>
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-bottom">
            <p>&copy; 2025 WhatsApp Medic Scheduler. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script src="js/main.js"></script>
</body>
</html>
