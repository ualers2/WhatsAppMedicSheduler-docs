<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - WhatsApp Medic Scheduler</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fab fa-whatsapp"></i>
            <span>WhatsApp Medic Scheduler</span>
        </div>
        <ul class="nav-links">
            <li><a href="index.html">Início</a></li>
            <li><a href="api.html" class="active">API Reference</a></li>
            <li><a href="webhooks.html">Webhooks</a></li>
            <li><a href="setup.html">Setup</a></li>
            <li><a href="https://github.com/ualers2/WhatsAppMedicSheduler" target="_blank"><i class="fab fa-github"></i></a></li>
        </ul>
    </nav>

    <!-- Page Header -->
    <header class="page-header">
        <h1><i class="fas fa-book"></i> API Reference</h1>
        <p>Documentação completa de todos os endpoints da API</p>
    </header>

    <!-- Main Content -->
    <div class="docs-container">
        <!-- Sidebar -->
        <aside class="docs-sidebar">
            <div class="sidebar-section">
                <h4>Introdução</h4>
                <ul>
                    <li><a href="#overview">Visão Geral</a></li>
                    <li><a href="#authentication">Autenticação</a></li>
                    <li><a href="#errors">Erros</a></li>
                </ul>
            </div>
            <div class="sidebar-section">
                <h4>Endpoints</h4>
                <ul>
                    <li><a href="#health">Health Check</a></li>
                    <li><a href="#webhook">Webhooks</a></li>
                    <li><a href="#patients">Patients</a></li>
                    <li><a href="#appointments">Appointments</a></li>
                    <li><a href="#doctors">Doctors</a></li>
                    <li><a href="#convenios">Convênios</a></li>
                </ul>
            </div>
        </aside>

        <!-- Content -->
        <main class="docs-content">
            <!-- Overview -->
            <section id="overview" class="doc-section">
                <h2>Visão Geral</h2>
                <p>A API do WhatsApp Medic Scheduler permite integração completa com o sistema de agendamento médico via WhatsApp.</p>
                
                <h3>Base URL</h3>
                <div class="code-block">
                    <pre><code>https://api.whatsappmedic.com/v1</code></pre>
                </div>

                <h3>Ambientes</h3>
                <table class="doc-table">
                    <thead>
                        <tr>
                            <th>Ambiente</th>
                            <th>URL</th>
                            <th>Descrição</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="env-badge dev">Development</span></td>
                            <td><code>http://localhost:5000</code></td>
                            <td>Ambiente local de desenvolvimento</td>
                        </tr>
                        <tr>
                            <td><span class="env-badge staging">Staging</span></td>
                            <td><code>https://staging-api.whatsappmedic.com</code></td>
                            <td>Ambiente de homologação</td>
                        </tr>
                        <tr>
                            <td><span class="env-badge prod">Production</span></td>
                            <td><code>https://api.whatsappmedic.com</code></td>
                            <td>Ambiente de produção</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Authentication -->
            <section id="authentication" class="doc-section">
                <h2>Autenticação</h2>
                <p>A API utiliza Bearer Token para autenticação. Inclua o token no header de todas as requisições:</p>
                
                <div class="code-block">
                    <div class="code-header">
                        <span>Header de Autenticação</span>
                        <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                    </div>
                    <pre><code>Authorization: Bearer YOUR_API_TOKEN</code></pre>
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <span>Para webhooks do WhatsApp, utilize o token de verificação configurado na Meta Business Suite.</span>
                </div>
            </section>

            <!-- Errors -->
            <section id="errors" class="doc-section">
                <h2>Códigos de Erro</h2>
                <table class="doc-table">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Status</th>
                            <th>Descrição</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>200</code></td>
                            <td>OK</td>
                            <td>Requisição bem-sucedida</td>
                        </tr>
                        <tr>
                            <td><code>201</code></td>
                            <td>Created</td>
                            <td>Recurso criado com sucesso</td>
                        </tr>
                        <tr>
                            <td><code>400</code></td>
                            <td>Bad Request</td>
                            <td>Requisição inválida ou malformada</td>
                        </tr>
                        <tr>
                            <td><code>401</code></td>
                            <td>Unauthorized</td>
                            <td>Token inválido ou ausente</td>
                        </tr>
                        <tr>
                            <td><code>403</code></td>
                            <td>Forbidden</td>
                            <td>Sem permissão para acessar o recurso</td>
                        </tr>
                        <tr>
                            <td><code>404</code></td>
                            <td>Not Found</td>
                            <td>Recurso não encontrado</td>
                        </tr>
                        <tr>
                            <td><code>429</code></td>
                            <td>Too Many Requests</td>
                            <td>Rate limit excedido</td>
                        </tr>
                        <tr>
                            <td><code>500</code></td>
                            <td>Server Error</td>
                            <td>Erro interno do servidor</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Health -->
            <section id="health" class="doc-section">
                <h2>Health Check</h2>
                
                <div class="endpoint-block">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/health</span>
                    </div>
                    <p>Verifica o status da API e seus componentes.</p>
                    
                    <h4>Response</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span>200 OK</span>
                            <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                        </div>
                        <pre><code class="json">{
  "status": "healthy",
  "version": "1.0.0",
  "timestamp": "2025-12-06T10:00:00Z",
  "components": {
    "database": "connected",
    "redis": "connected",
    "whatsapp_api": "connected"
  }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Webhook -->
            <section id="webhook" class="doc-section">
                <h2>Webhooks</h2>
                
                <!-- GET Webhook -->
                <div class="endpoint-block">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/webhook</span>
                    </div>
                    <p>Endpoint de verificação do webhook pela Meta. Usado durante a configuração inicial.</p>
                    
                    <h4>Query Parameters</h4>
                    <table class="params-table">
                        <thead>
                            <tr>
                                <th>Parâmetro</th>
                                <th>Tipo</th>
                                <th>Obrigatório</th>
                                <th>Descrição</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>hub.mode</code></td>
                                <td>string</td>
                                <td>Sim</td>
                                <td>Deve ser "subscribe"</td>
                            </tr>
                            <tr>
                                <td><code>hub.verify_token</code></td>
                                <td>string</td>
                                <td>Sim</td>
                                <td>Token de verificação configurado</td>
                            </tr>
                            <tr>
                                <td><code>hub.challenge</code></td>
                                <td>string</td>
                                <td>Sim</td>
                                <td>Challenge enviado pela Meta</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>Response</h4>
                    <div class="code-block">
                        <pre><code>200 OK - Retorna o hub.challenge</code></pre>
                    </div>
                </div>

                <!-- POST Webhook -->
                <div class="endpoint-block">
                    <div class="endpoint-header">
                        <span class="method post">POST</span>
                        <span class="endpoint-path">/webhook</span>
                    </div>
                    <p>Recebe mensagens e eventos do WhatsApp Business API.</p>
                    
                    <h4>Request Body</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span>application/json</span>
                            <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                        </div>
                        <pre><code class="json">{
  "object": "whatsapp_business_account",
  "entry": [{
    "id": "WHATSAPP_BUSINESS_ACCOUNT_ID",
    "changes": [{
      "value": {
        "messaging_product": "whatsapp",
        "metadata": {
          "display_phone_number": "5511999999999",
          "phone_number_id": "PHONE_NUMBER_ID"
        },
        "contacts": [{
          "profile": { "name": "João Silva" },
          "wa_id": "5511988888888"
        }],
        "messages": [{
          "from": "5511988888888",
          "id": "wamid.xxx",
          "timestamp": "1701864000",
          "type": "text",
          "text": { "body": "Olá, gostaria de agendar uma consulta" }
        }]
      },
      "field": "messages"
    }]
  }]
}</code></pre>
                    </div>

                    <h4>Response</h4>
                    <div class="code-block">
                        <pre><code class="json">{ "status": "received" }</code></pre>
                    </div>
                </div>
            </section>

            <!-- Patients -->
            <section id="patients" class="doc-section">
                <h2>Patients</h2>
                
                <!-- GET Patients -->
                <div class="endpoint-block">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/patients</span>
                    </div>
                    <p>Lista todos os pacientes cadastrados.</p>
                    
                    <h4>Query Parameters</h4>
                    <table class="params-table">
                        <thead>
                            <tr>
                                <th>Parâmetro</th>
                                <th>Tipo</th>
                                <th>Obrigatório</th>
                                <th>Descrição</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>page</code></td>
                                <td>integer</td>
                                <td>Não</td>
                                <td>Página (default: 1)</td>
                            </tr>
                            <tr>
                                <td><code>limit</code></td>
                                <td>integer</td>
                                <td>Não</td>
                                <td>Itens por página (default: 20)</td>
                            </tr>
                            <tr>
                                <td><code>phone</code></td>
                                <td>string</td>
                                <td>Não</td>
                                <td>Filtrar por telefone</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- POST Patient -->
                <div class="endpoint-block">
                    <div class="endpoint-header">
                        <span class="method post">POST</span>
                        <span class="endpoint-path">/api/patients</span>
                    </div>
                    <p>Cria ou atualiza um paciente.</p>
                    
                    <h4>Request Body</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span>application/json</span>
                            <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                        </div>
                        <pre><code class="json">{
  "name": "João Silva",
  "phone": "5511988888888",
  "cpf": "12345678900",
  "email": "joao@email.com",
  "birth_date": "1990-05-15",
  "convenio_id": 1
}</code></pre>
                    </div>

                    <h4>Response</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span>201 Created</span>
                        </div>
                        <pre><code class="json">{
  "id": 123,
  "name": "João Silva",
  "phone": "5511988888888",
  "cpf": "12345678900",
  "email": "joao@email.com",
  "birth_date": "1990-05-15",
  "convenio_id": 1,
  "created_at": "2025-12-06T10:00:00Z"
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Appointments -->
            <section id="appointments" class="doc-section">
                <h2>Appointments</h2>
                
                <!-- GET Appointments -->
                <div class="endpoint-block">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/appointments</span>
                    </div>
                    <p>Lista agendamentos com filtros opcionais.</p>
                    
                    <h4>Query Parameters</h4>
                    <table class="params-table">
                        <thead>
                            <tr>
                                <th>Parâmetro</th>
                                <th>Tipo</th>
                                <th>Obrigatório</th>
                                <th>Descrição</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>patient_id</code></td>
                                <td>integer</td>
                                <td>Não</td>
                                <td>Filtrar por paciente</td>
                            </tr>
                            <tr>
                                <td><code>doctor_id</code></td>
                                <td>integer</td>
                                <td>Não</td>
                                <td>Filtrar por médico</td>
                            </tr>
                            <tr>
                                <td><code>date_from</code></td>
                                <td>date</td>
                                <td>Não</td>
                                <td>Data inicial (YYYY-MM-DD)</td>
                            </tr>
                            <tr>
                                <td><code>date_to</code></td>
                                <td>date</td>
                                <td>Não</td>
                                <td>Data final (YYYY-MM-DD)</td>
                            </tr>
                            <tr>
                                <td><code>status</code></td>
                                <td>string</td>
                                <td>Não</td>
                                <td>scheduled, confirmed, cancelled, completed</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- POST Appointment -->
                <div class="endpoint-block">
                    <div class="endpoint-header">
                        <span class="method post">POST</span>
                        <span class="endpoint-path">/api/appointments</span>
                    </div>
                    <p>Cria um novo agendamento.</p>
                    
                    <h4>Request Body</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span>application/json</span>
                            <button class="copy-btn" onclick="copyCode(this)"><i class="fas fa-copy"></i></button>
                        </div>
                        <pre><code class="json">{
  "patient_id": 123,
  "doctor_id": 45,
  "specialty_id": 3,
  "date": "2025-12-10",
  "time": "14:30",
  "type": "consultation",
  "notes": "Primeira consulta"
}</code></pre>
                    </div>

                    <h4>Response</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span>201 Created</span>
                        </div>
                        <pre><code class="json">{
  "id": 456,
  "patient_id": 123,
  "doctor_id": 45,
  "specialty_id": 3,
  "date": "2025-12-10",
  "time": "14:30",
  "type": "consultation",
  "status": "scheduled",
  "confirmation_code": "AGD-2025-456",
  "created_at": "2025-12-06T10:00:00Z"
}</code></pre>
                    </div>
                </div>

                <!-- DELETE Appointment -->
                <div class="endpoint-block">
                    <div class="endpoint-header">
                        <span class="method delete">DELETE</span>
                        <span class="endpoint-path">/api/appointments/{id}</span>
                    </div>
                    <p>Cancela um agendamento existente.</p>
                    
                    <h4>Path Parameters</h4>
                    <table class="params-table">
                        <thead>
                            <tr>
                                <th>Parâmetro</th>
                                <th>Tipo</th>
                                <th>Descrição</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>id</code></td>
                                <td>integer</td>
                                <td>ID do agendamento</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Doctors -->
            <section id="doctors" class="doc-section">
                <h2>Doctors</h2>
                
                <div class="endpoint-block">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/doctors</span>
                    </div>
                    <p>Lista médicos disponíveis.</p>
                    
                    <h4>Query Parameters</h4>
                    <table class="params-table">
                        <thead>
                            <tr>
                                <th>Parâmetro</th>
                                <th>Tipo</th>
                                <th>Obrigatório</th>
                                <th>Descrição</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>specialty_id</code></td>
                                <td>integer</td>
                                <td>Não</td>
                                <td>Filtrar por especialidade</td>
                            </tr>
                            <tr>
                                <td><code>convenio_id</code></td>
                                <td>integer</td>
                                <td>Não</td>
                                <td>Filtrar por convênio aceito</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="endpoint-block">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/doctors/{id}/availability</span>
                    </div>
                    <p>Retorna horários disponíveis de um médico.</p>
                    
                    <h4>Query Parameters</h4>
                    <table class="params-table">
                        <thead>
                            <tr>
                                <th>Parâmetro</th>
                                <th>Tipo</th>
                                <th>Obrigatório</th>
                                <th>Descrição</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>date</code></td>
                                <td>date</td>
                                <td>Sim</td>
                                <td>Data para verificar (YYYY-MM-DD)</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>Response</h4>
                    <div class="code-block">
                        <pre><code class="json">{
  "doctor_id": 45,
  "date": "2025-12-10",
  "available_slots": [
    "08:00", "08:30", "09:00", "09:30",
    "14:00", "14:30", "15:00", "15:30"
  ]
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Convenios -->
            <section id="convenios" class="doc-section">
                <h2>Convênios</h2>
                
                <div class="endpoint-block">
                    <div class="endpoint-header">
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/convenios</span>
                    </div>
                    <p>Lista todos os convênios aceitos.</p>
                    
                    <h4>Response</h4>
                    <div class="code-block">
                        <pre><code class="json">{
  "convenios": [
    { "id": 1, "name": "Unimed", "code": "UNI" },
    { "id": 2, "name": "Bradesco Saúde", "code": "BRA" },
    { "id": 3, "name": "SulAmérica", "code": "SUL" },
    { "id": 4, "name": "Particular", "code": "PAR" }
  ]
}</code></pre>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-bottom">
            <p>&copy; 2025 WhatsApp Medic Scheduler. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script src="js/main.js"></script>
</body>
</html>
